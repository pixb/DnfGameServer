# pix-jptotobuf-to-proto 技能

## 📋 简介

pix-jptotobuf-to-proto 是一个专门用于从 JProtobuf 迁移到标准 Protobuf 的工具技能。它提供结构化的迁移流程，确保跨语言通信正常，减少迁移风险，积累迁移经验。

## 🎯 核心功能

### 1. 迁移流程管理

提供完整的 7 步迁移流程，从分析到测试的全过程。

- **步骤 1**：分析 Java 文件
- **步骤 2**：生成 Proto 文件
- **步骤 3**：生成 Go 代码
- **步骤 4**：编写 Go 测试用例
- **步骤 5**：生成 Java 代码
- **步骤 6**：调试 Java 服务端
- **步骤 7**：运行 Go 测试用例

**详细文档**：[01_迁移流程.md](./01_迁移流程.md)

### 2. 类型映射

提供 JProtobuf 到标准 Protobuf 的完整类型映射表，包括基本类型、复杂类型和特殊类型。

- **基本类型**：整数类型、浮点类型、字符串和字节类型、布尔类型
- **复杂类型**：列表类型、映射类型、嵌套消息、枚举类型
- **特殊类型**：可选字段、默认值、Oneof 类型

**详细文档**：[02_类型映射.md](./02_类型映射.md)

### 3. 问题解决

提供 16 个常见问题的解决方案，涵盖代码生成、编译错误、运行时错误和配置问题。

- **代码生成问题**（6个）：生成文件过多、Java package 路径问题、Go 测试导入错误等
- **编译错误**（5个）：Java 编译错误、重复类定义、Proto 文件语法错误等
- **运行时错误**（3个）：Unknown module ID、NullPointerException、序列化不兼容
- **配置问题**（2个）：Maven 配置问题、服务启动失败

**详细文档**：[03_常见问题.md](./03_常见问题.md)

### 4. 双模式编解码器

提供双模式编解码器的完整实现，支持渐进式迁移和灰度发布。

- **MessageCodecFactory**：根据配置动态切换编解码器
- **StandardProtobufDecoder**：解码标准 Protobuf 格式的消息并适配为 JProtobuf 消息
- **StandardProtobufEncoder**：将 JProtobuf 消息适配为标准 Protobuf 格式并编码

**详细文档**：[04_双模式编解码器.md](./04_双模式编解码器.md)

### 5. 跨语言通信测试

提供跨语言通信测试的完整指南，包括测试环境准备、消息头结构、测试验证要点。

- **测试环境准备**：Java 服务端和 Go 客户端的配置
- **消息头结构**：详细的协议格式说明
- **测试验证要点**：4个关键验证点
- **测试成功标准**：6个验证标准

**详细文档**：[05_跨语言通信测试.md](./05_跨语言通信测试.md)

### 6. 经验总结

提供经验总结模板，用于记录迁移过程中遇到的问题、解决方案和最佳实践。

- **迁移基本信息**：批次编号、迁移日期、迁移文件数、迁移状态
- **迁移文件清单**：Java 文件、Proto 文件、生成的代码
- **问题记录**：问题描述、原因分析、解决方案、预防措施
- **最佳实践**：实践描述、实施方法、效果评估
- **避免事项**：问题描述、正确做法
- **改进建议**：流程改进、工具改进、文档改进

**详细文档**：[06_经验总结模板.md](./06_经验总结模板.md)

## 🚀 快速开始

### 激活技能

当你询问以下类型的问题时，pix-jptotobuf-to-proto 会自动激活：

- "迁移 JProtobuf 到标准 Protobuf"
- "将 Java 的 JProtobuf 转换为标准 Protobuf"
- "批量迁移 JProtobuf 协议"
- "JProtobuf 到 Proto 的映射"
- "为 JProtobuf 迁移创建批次计划"

### 预期输出

pix-jptotobuf-to-proto 会提供：
1. 完整的 7 步迁移流程指南
2. 详细的文件映射和类型转换规则
3. 批次化的迁移计划和文档模板
4. 跨语言测试策略和验证方法
5. 经验总结和问题解决方案

## 📚 文档结构

```
pix-jptotobuf-to-proto/
├── SKILL.md                      ← 核心技能文件（主文档）
├── README.md                     ← 技能说明文档（本文件）
├── 01_迁移流程.md               ← 7步迁移流程详解
├── 02_类型映射.md               ← JProtobuf到标准Protobuf类型映射
├── 03_常见问题.md               ← 16个常见问题与解决方案
├── 04_双模式编解码器.md         ← 双模式编解码器实现
├── 05_跨语言通信测试.md         ← 跨语言通信测试指南
└── 06_经验总结模板.md           ← 经验总结模板
```

## 🛠️ 工具和命令

### 核心命令

| 命令 | 描述 | 用途 |
| :--- | :--- | :--- |
| `buf generate` | 生成多语言代码 | 生成 Go 和 Java 代码 |
| `go test ./...` | 运行 Go 测试 | 验证 Go 代码功能 |
| `mvn clean compile` | 编译 Java 项目 | 验证 Java 代码编译 |
| `mvn spring-boot:run` | 启动 Java 服务 | 测试服务端功能 |

### 配置文件

| 文件 | 用途 | 位置 |
| :--- | :--- | :--- |
| `proto/buf.yaml` | buf 配置 | 主项目根目录 |
| `proto/buf.gen.yaml` | 代码生成配置 | 主项目根目录 |
| `proto/dnf/v1/*.proto` | Proto 协议文件 | 按包结构组织 |

## 📋 最佳实践

### 迁移策略

- **渐进式迁移**：每次只迁移 1-2 个文件，降低风险
- **充分测试**：每个步骤都要测试通过，确保质量
- **文档化**：详细记录迁移过程和经验，便于后续参考
- **跨语言验证**：确保 Java 和 Go 通信正常，验证兼容性

### 代码质量

- **Null 检查**：在消息适配方法中为所有字段添加 null 检查
- **模块化设计**：将功能拆分为独立的模块，便于维护
- **错误处理**：全面的错误捕获和处理，提供友好的错误信息
- **代码注释**：详细的代码注释和文档，便于理解和维护

### 性能优化

- **缓存策略**：合理使用缓存减少重复计算
- **异步处理**：使用异步操作提高性能
- **资源管理**：及时释放不需要的资源
- **代码优化**：减少不必要的计算和操作

### 用户体验

- **清晰的输出**：结构化、易读的输出格式
- **友好的错误信息**：详细、有用的错误提示
- **进度反馈**：长时间操作的进度提示
- **合理的默认值**：为参数提供合理的默认值

### 风险控制

- **回退方案**：保留旧的 JProtobuf 实现，便于快速回退
- **灰度发布**：逐步切换到新协议，降低风险
- **监控**：添加日志监控协议使用情况
- **测试覆盖**：确保测试覆盖所有场景

## 📊 迁移成功标准

### Go 侧验证

- ✅ 所有 Go 测试用例通过
- ✅ Go 代码编译无错误
- ✅ 序列化/反序列化正确
- ✅ 边界值测试通过

### Java 侧验证

- ✅ 所有 Java 测试用例通过
- ✅ Java 代码编译无错误
- ✅ 服务启动成功
- ✅ 消息处理正确

### 集成验证

- ✅ Go 客户端能发送请求
- ✅ Java 服务端能接收请求
- ✅ Java 服务端能发送响应
- ✅ Go 客户端能接收响应
- ✅ 跨语言通信正常

## 📚 参考资源

### 工具文档
- [Buf 官方文档](https://buf.build/docs)
- [Protobuf 官方文档](https://protobuf.dev)
- [Go Protobuf 文档](https://pkg.go.dev/google.golang.org/protobuf)

### 技能文档
- [SKILL.md](./SKILL.md) - 核心技能文件
- [01_迁移流程.md](./01_迁移流程.md) - 7 步迁移流程详解
- [02_类型映射.md](./02_类型映射.md) - JProtobuf 到标准 Protobuf 类型映射
- [03_常见问题.md](./03_常见问题.md) - 常见问题与解决方案
- [04_双模式编解码器.md](./04_双模式编解码器.md) - 双模式编解码器实现
- [05_跨语言通信测试.md](./05_跨语言通信测试.md) - 跨语言通信测试指南
- [06_经验总结模板.md](./06_经验总结模板.md) - 经验总结模板

## 🌟 总结

pix-jptotobuf-to-proto 技能提供了一个结构化、可重复的 JProtobuf 到标准 Protobuf 迁移流程。通过遵循 7 步迁移流程，使用批次化文档管理，结合跨语言测试验证，可以确保迁移过程安全、高效，同时积累宝贵的迁移经验。

记住，成功的迁移应该：
1. **计划先行**：详细的迁移计划和文档
2. **测试驱动**：每个步骤都有充分的测试
3. **渐进式**：小规模、可控的迁移步伐
4. **经验积累**：详细记录问题和解决方案
5. **跨语言验证**：确保不同语言间通信正常

## 📝 版本历史

### v1.0.0 (2026-02-09)

- ✅ 初始版本发布
- ✅ 完整的 7 步迁移流程
- ✅ 详细的类型映射表
- ✅ 16 个常见问题解决方案
- ✅ 双模式编解码器实现
- ✅ 跨语言通信测试指南
- ✅ 经验总结模板

## 📄 许可证

本技能遵循 Trae Skills 架构和最佳实践。

## 🤝 贡献

欢迎提出改进建议和问题反馈！

---

**现在，你已经准备好开始 JProtobuf 到标准 Protobuf 的迁移了！** 🚀
