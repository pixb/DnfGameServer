# 批次 01 文件映射

## 一、Java文件分析

### 1.1 PT_CHANNEL_INFO.java

**文件路径**：`src/main/java/com/dnfm/mina/protobuf/PT_CHANNEL_INFO.java`

**消息结构**：

```java
public class PT_CHANNEL_INFO {
   @Protobuf(fieldType = FieldType.INT32, order = 1, required = false)
   public Integer world;
   @Protobuf(fieldType = FieldType.INT32, order = 2, required = false)
   public Integer channel;
   @Protobuf(fieldType = FieldType.STRING, order = 3, required = false)
   public String ip;
   @Protobuf(fieldType = FieldType.INT32, order = 4, required = false)
   public Integer port;
   @Protobuf(fieldType = FieldType.INT32, order = 5, required = false)
   public Integer priority;
}
```

**依赖**：无

### 1.2 PT_INTRUDE_MEMBER_INFO.java

**文件路径**：`src/main/java/com/dnfm/mina/protobuf/PT_INTRUDE_MEMBER_INFO.java`

**消息结构**：

```java
public class PT_INTRUDE_MEMBER_INFO {
   @Protobuf(fieldType = FieldType.STRING, order = 1, required = false)
   public String name;
   @Protobuf(fieldType = FieldType.INT32, order = 2, required = false)
   public Integer level;
   @Protobuf(fieldType = FieldType.INT32, order = 3, required = false)
   public Integer job;
   @Protobuf(fieldType = FieldType.INT32, order = 4, required = false)
   public Integer growtype;
   @Protobuf(fieldType = FieldType.INT32, order = 5, required = false)
   public Integer secgrowtype;
}
```

**依赖**：无

### 1.3 PT_INTRUDE_INFO.java

**文件路径**：`src/main/java/com/dnfm/mina/protobuf/PT_INTRUDE_INFO.java`

**消息结构**：

```java
public class PT_INTRUDE_INFO {
   @Protobuf(fieldType = FieldType.BOOL, order = 1, required = false)
   public Boolean intrude;
   @Protobuf(fieldType = FieldType.STRING, order = 2, required = false)
   public String name;
   @Protobuf(fieldType = FieldType.UINT64, order = 3, required = false)
   public Long guid;
   @Protobuf(order = 4, required = false)
   public PT_CHANNEL_INFO channel;
   @Protobuf(order = 5)
   public List<PT_INTRUDE_MEMBER_INFO> partymembers;
   @Protobuf(fieldType = FieldType.UINT64, order = 6, required = false)
   public Long rpguid;
}
```

**依赖**：PT_CHANNEL_INFO, PT_INTRUDE_MEMBER_INFO

### 1.4 REQ_LOGIN.java

**文件路径**：`src/main/java/com/dnfm/mina/protobuf/REQ_LOGIN.java`

**消息结构**：

```java
@MessageMeta(module = 10000, cmd = 0)
public class REQ_LOGIN extends Message {
   @Protobuf(fieldType = FieldType.STRING, order = 1)
   public String openid;
   @Protobuf(fieldType = FieldType.UINT32, order = 2)
   public Integer type;
   @Protobuf(fieldType = FieldType.STRING, order = 3)
   public String token;
   @Protobuf(fieldType = FieldType.UINT32, order = 4)
   public Integer platID;
   @Protobuf(fieldType = FieldType.STRING, order = 5)
   public String clientIP;
   @Protobuf(fieldType = FieldType.STRING, order = 6)
   public String version;
   @Protobuf(fieldType = FieldType.STRING, order = 7)
   public String friendopenid;
   @Protobuf(fieldType = FieldType.UINT32, order = 8)
   public Integer cancelunregist;
   @Protobuf(fieldType = FieldType.STRING, order = 9)
   public String countrycode;
   @Protobuf(fieldType = FieldType.INT32, order = 10)
   public Integer toyplatid;
   @Protobuf(fieldType = FieldType.INT32, order = 11)
   public Integer agetype;
}
```

**依赖**：无

### 1.5 RES_LOGIN.java

**文件路径**：`src/main/java/com/dnfm/mina/protobuf/RES_LOGIN.java`

**消息结构**：

```java
@MessageMeta(module = 10000, cmd = 1)
public class RES_LOGIN extends Message {
   @Protobuf(fieldType = FieldType.INT32, order = 1, required = false)
   public Integer error;
   @Protobuf(fieldType = FieldType.STRING, order = 2, required = false)
   public String authkey;
   @Protobuf(fieldType = FieldType.STRING, order = 3, required = false)
   public String accountkey;
   @Protobuf(fieldType = FieldType.BOOL, order = 4, required = false)
   public Boolean encrypt;
   @Protobuf(fieldType = FieldType.UINT64, order = 5, required = false)
   public Long servertime;
   @Protobuf(fieldType = FieldType.STRING, order = 6, required = false)
   public String localtime;
   @Protobuf(fieldType = FieldType.UINT32, order = 7, required = false)
   public Integer authority;
   @Protobuf(fieldType = FieldType.STRING, order = 8, required = false)
   public String key;
   @Protobuf(order = 9)
   public List<PT_CHANNEL_INFO> channel;
   @Protobuf(order = 10, required = false)
   public PT_INTRUDE_INFO intrudeinfo;
   @Protobuf(fieldType = FieldType.INT32, order = 11, required = false)
   public Integer worldid;
   @Protobuf(fieldType = FieldType.INT32, order = 12)
   public List<Integer> seeds;
}
```

**依赖**：PT_CHANNEL_INFO, PT_INTRUDE_INFO

## 二、Proto文件映射

### 2.1 auth_login.proto

**文件路径**：`proto/dnf/v1/auth_login.proto`

**消息定义**：

```protobuf
// 渠道信息
message ChannelInfo {
  int32 world = 1;
  int32 channel = 2;
  string ip = 3;
  int32 port = 4;
  int32 priority = 5;
}

// 入侵成员信息
message IntrudeMemberInfo {
  string name = 1;
  int32 level = 2;
  int32 job = 3;
  int32 growtype = 4;
  int32 secgrowtype = 5;
}

// 入侵信息
message IntrudeInfo {
  bool intrude = 1;
  string name = 2;
  uint64 guid = 3;
  ChannelInfo channel = 4;
  repeated IntrudeMemberInfo party_members = 5;
  uint64 rp_guid = 6;
}

// 登录请求 (module=10000, cmd=1)
message LoginRequest {
  string openid = 1;
  uint32 type = 2;
  string token = 3;
  uint32 platID = 4;
  string clientIP = 5;
  string version = 6;
  string friendopenid = 7;
  uint32 cancelunregist = 8;
  string countrycode = 9;
  int32 toyplatid = 10;
  int32 agetype = 11;
}

// 登录响应 (module=10000, cmd=2)
message LoginResponse {
  int32 error = 1;
  string authkey = 2;
  string accountkey = 3;
  bool encrypt = 4;
  uint64 servertime = 5;
  string localtime = 6;
  uint32 authority = 7;
  string key = 8;
  repeated ChannelInfo channel = 9;
  IntrudeInfo intrudeinfo = 10;
  int32 worldid = 11;
  repeated int32 seeds = 12;
}
```

## 三、字段映射表

### 3.1 ChannelInfo 字段映射

| Java字段 | Java类型 | JProtobuf类型 | 标准Protobuf类型 | 字段序号 |
|----------|----------|--------------|------------------|----------|
| world | Integer | FieldType.INT32 | int32 | 1 |
| channel | Integer | FieldType.INT32 | int32 | 2 |
| ip | String | FieldType.STRING | string | 3 |
| port | Integer | FieldType.INT32 | int32 | 4 |
| priority | Integer | FieldType.INT32 | int32 | 5 |

### 3.2 IntrudeMemberInfo 字段映射

| Java字段 | Java类型 | JProtobuf类型 | 标准Protobuf类型 | 字段序号 |
|----------|----------|--------------|------------------|----------|
| name | String | FieldType.STRING | string | 1 |
| level | Integer | FieldType.INT32 | int32 | 2 |
| job | Integer | FieldType.INT32 | int32 | 3 |
| growtype | Integer | FieldType.INT32 | int32 | 4 |
| secgrowtype | Integer | FieldType.INT32 | int32 | 5 |

### 3.3 IntrudeInfo 字段映射

| Java字段 | Java类型 | JProtobuf类型 | 标准Protobuf类型 | 字段序号 |
|----------|----------|--------------|------------------|----------|
| intrude | Boolean | FieldType.BOOL | bool | 1 |
| name | String | FieldType.STRING | string | 2 |
| guid | Long | FieldType.UINT64 | uint64 | 3 |
| channel | PT_CHANNEL_INFO | 无 | ChannelInfo | 4 |
| partymembers | List<PT_INTRUDE_MEMBER_INFO> | 无 | repeated IntrudeMemberInfo | 5 |
| rpguid | Long | FieldType.UINT64 | uint64 | 6 |

### 3.4 LoginRequest 字段映射

| Java字段 | Java类型 | JProtobuf类型 | 标准Protobuf类型 | 字段序号 |
|----------|----------|--------------|------------------|----------|
| openid | String | FieldType.STRING | string | 1 |
| type | Integer | FieldType.UINT32 | uint32 | 2 |
| token | String | FieldType.STRING | string | 3 |
| platID | Integer | FieldType.UINT32 | uint32 | 4 |
| clientIP | String | FieldType.STRING | string | 5 |
| version | String | FieldType.STRING | string | 6 |
| friendopenid | String | FieldType.STRING | string | 7 |
| cancelunregist | Integer | FieldType.UINT32 | uint32 | 8 |
| countrycode | String | FieldType.STRING | string | 9 |
| toyplatid | Integer | FieldType.INT32 | int32 | 10 |
| agetype | Integer | FieldType.INT32 | int32 | 11 |

### 3.5 LoginResponse 字段映射

| Java字段 | Java类型 | JProtobuf类型 | 标准Protobuf类型 | 字段序号 |
|----------|----------|--------------|------------------|----------|
| error | Integer | FieldType.INT32 | int32 | 1 |
| authkey | String | FieldType.STRING | string | 2 |
| accountkey | String | FieldType.STRING | string | 3 |
| encrypt | Boolean | FieldType.BOOL | bool | 4 |
| servertime | Long | FieldType.UINT64 | uint64 | 5 |
| localtime | String | FieldType.STRING | string | 6 |
| authority | Integer | FieldType.UINT32 | uint32 | 7 |
| key | String | FieldType.STRING | string | 8 |
| channel | List<PT_CHANNEL_INFO> | 无 | repeated ChannelInfo | 9 |
| intrudeinfo | PT_INTRUDE_INFO | 无 | IntrudeInfo | 10 |
| worldid | Integer | FieldType.INT32 | int32 | 11 |
| seeds | List<Integer> | 无 | repeated int32 | 12 |

## 四、类型映射说明

### 4.1 基本类型映射

| JProtobuf类型 | 标准Protobuf类型 | 说明 |
|--------------|------------------|------|
| FieldType.BOOL | bool | 布尔值 |
| FieldType.UINT64 | uint64 | 64位无符号整数 |
| FieldType.UINT32 | uint32 | 32位无符号整数 |
| FieldType.INT32 | int32 | 32位有符号整数 |
| FieldType.STRING | string | 字符串 |

### 4.2 集合类型映射

| JProtobuf类型 | 标准Protobuf类型 | 说明 |
|--------------|------------------|------|
| List<T> | repeated T | 重复字段 |

### 4.3 消息类型映射

| JProtobuf类型 | 标准Protobuf类型 | 说明 |
|--------------|------------------|------|
| 自定义类 | message | 消息类型 |

### 4.4 注意事项

1. **字段序号**：保持与Java文件完全一致
2. **字段类型**：正确映射JProtobuf类型到标准Protobuf类型
3. **字段命名**：使用snake_case命名规范
4. **消息命名**：使用PascalCase命名规范
5. **依赖顺序**：按照依赖顺序定义消息（基础类型 → 复合类型）

## 五、生成代码路径

### 5.1 Go代码
- **生成路径**：`dnf-go-client/gen/go/dnf/v1/auth_login.pb.go`
- **包名**：`dnf.v1`

### 5.2 Java代码
- **生成路径**：`gen/java/com/dnfm/mina/protobuf/generated/AuthLoginProto.java`
- **包名**：`com.dnfm.mina.protobuf.generated`

## 六、验证要点

1. **字段映射正确性**：确保所有字段都正确映射
2. **类型一致性**：确保跨语言类型一致
3. **序列化兼容性**：确保新旧协议序列化结果兼容
4. **反序列化兼容性**：确保新旧协议反序列化结果兼容
5. **依赖关系正确性**：确保依赖关系正确

## 七、后续步骤

1. 执行 `buf generate --path dnf/v1/auth_login.proto` 生成代码
2. 编写并运行Go测试用例（5个消息类型）
3. 生成并集成Java代码
4. 调试Java服务端
5. 再次运行Go测试用例验证
