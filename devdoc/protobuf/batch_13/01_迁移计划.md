# 批次13迁移计划：冒险模块（ADVENTURE）

## 一、迁移范围

### 1.1 消息类型

| ModuleID | 消息类型 | 功能描述 | 状态 |
| :--- | :--- | :--- | :--- |
| 18000 | 冒险数据 | 获取冒险相关数据 | ✅ 待迁移 |
| 18001 | 冒险收获信息 | 获取冒险收获信息 | ✅ 待迁移 |
| 18002 | 冒险收获奖励 | 领取冒险收获奖励 | ✅ 待迁移 |
| 18003 | 冒险存储列表 | 获取冒险存储列表 | ✅ 待迁移 |
| 18004 | 冒险自动搜索 | 自动搜索冒险奖励 | ✅ 待迁移 |
| 18005 | 冒险自动搜索奖励 | 领取自动搜索奖励 | ✅ 待迁移 |
| 18006 | 冒险书信息 | 获取冒险书信息 | ✅ 待迁移 |
| 18007 | 冒险书特殊奖励 | 领取冒险书特殊奖励 | ✅ 待迁移 |
| 18008 | 冒险书泰拉奖励 | 领取冒险书泰拉奖励 | ✅ 待迁移 |
| 18009 | 冒险书条件更新 | 更新冒险书条件 | ✅ 待迁移 |

### 1.2 迁移文件

| 文件名 | 功能描述 | 状态 |
| :--- | :--- | :--- |
| `REQ_ADVENTURE_DATA.java` | 冒险数据请求 | ✅ 待迁移 |
| `RES_ADVENTURE_DATA.java` | 冒险数据响应 | ✅ 待迁移 |
| `REQ_ADVENTURE_REAP_INFO.java` | 冒险收获信息请求 | ✅ 待迁移 |
| `RES_ADVENTURE_REAP_INFO.java` | 冒险收获信息响应 | ✅ 待迁移 |
| `REQ_ADVENTURE_REAP_REWARD.java` | 冒险收获奖励请求 | ✅ 待迁移 |
| `RES_ADVENTURE_REAP_REWARD.java` | 冒险收获奖励响应 | ✅ 待迁移 |
| `REQ_ADVENTURE_STORAGE_LIST.java` | 冒险存储列表请求 | ✅ 待迁移 |
| `RES_ADVENTURE_STORAGE_LIST.java` | 冒险存储列表响应 | ✅ 待迁移 |
| `REQ_ADVENTURE_AUTO_SEARCH_MINI_GAME.java` | 冒险自动搜索请求 | ✅ 待迁移 |
| `RES_ADVENTURE_AUTO_SEARCH_MINI_GAME.java` | 冒险自动搜索响应 | ✅ 待迁移 |
| `REQ_ADVENTURE_AUTO_SEARCH_REWARD.java` | 冒险自动搜索奖励请求 | ✅ 待迁移 |
| `RES_ADVENTURE_AUTO_SEARCH_REWARD.java` | 冒险自动搜索奖励响应 | ✅ 待迁移 |
| `REQ_ADVENTUREBOOK_INFO.java` | 冒险书信息请求 | ✅ 待迁移 |
| `RES_ADVENTUREBOOK_INFO.java` | 冒险书信息响应 | ✅ 待迁移 |
| `REQ_ADVENTUREBOOK_SPECIAL_REWARD.java` | 冒险书特殊奖励请求 | ✅ 待迁移 |
| `RES_ADVENTUREBOOK_SPECIAL_REWARD.java` | 冒险书特殊奖励响应 | ✅ 待迁移 |
| `REQ_ADVENTUREBOOK_TERA_REWARD.java` | 冒险书泰拉奖励请求 | ✅ 待迁移 |
| `RES_ADVENTUREBOOK_TERA_REWARD.java` | 冒险书泰拉奖励响应 | ✅ 待迁移 |
| `REQ_ADVENTUREBOOK_UPDATE_CONDITION.java` | 冒险书条件更新请求 | ✅ 待迁移 |
| `RES_ADVENTUREBOOK_UPDATE_CONDITION.java` | 冒险书条件更新响应 | ✅ 待迁移 |

## 二、迁移步骤

### 2.1 分析阶段

1. **文件分析**：分析冒险模块相关的Java文件，了解字段结构和依赖关系
2. **类型映射**：确定JProtobuf到标准Protobuf的类型映射
3. **依赖分析**：识别冒险模块依赖的其他数据结构

### 2.2 设计阶段

1. **Proto文件设计**：创建`adventure.proto`文件，定义冒险相关消息
2. **消息结构设计**：设计冒险数据、收获信息、收获奖励等消息结构
3. **数据结构设计**：设计冒险相关的数据结构

### 2.3 实现阶段

1. **代码生成**：使用buf生成Java和Go代码
2. **编解码器扩展**：扩展StandardProtobufDecoder和StandardProtobufEncoder
3. **消息适配**：实现冒险相关消息的编解码适配

### 2.4 测试阶段

1. **单元测试**：编写Go单元测试验证消息序列化/反序列化
2. **编译测试**：运行Java编译验证代码正确性
3. **集成测试**：验证冒险模块与其他模块的集成

## 三、数据结构

### 3.1 冒险相关

| 数据结构 | 描述 | 状态 |
| :--- | :--- | :--- |
| `AdventureData` | 冒险数据 | ✅ 待定义 |
| `AdventureReapInfo` | 冒险收获信息 | ✅ 待定义 |
| `AdventureReapReward` | 冒险收获奖励 | ✅ 待定义 |
| `AdventureStorageItem` | 冒险存储物品 | ✅ 待定义 |
| `AdventureAutoSearch` | 冒险自动搜索 | ✅ 待定义 |
| `AdventureBookInfo` | 冒险书信息 | ✅ 待定义 |
| `AdventureBookReward` | 冒险书奖励 | ✅ 待定义 |
| `AdventureBookCondition` | 冒险书条件 | ✅ 待定义 |

## 四、测试策略

### 4.1 单元测试

- **Go测试**：编写`batch13_test.go`测试文件
- **测试场景**：
  - 冒险数据消息序列化/反序列化
  - 冒险收获信息消息序列化/反序列化
  - 冒险收获奖励消息序列化/反序列化
  - 冒险存储列表消息序列化/反序列化
  - 冒险自动搜索消息序列化/反序列化
  - 冒险书相关消息序列化/反序列化
  - 边界情况测试

### 4.2 集成测试

- **编解码测试**：验证Java和Go之间的消息编解码
- **模块集成**：验证冒险模块与角色模块的集成

### 4.3 回退策略

- 保留原始JProtobuf实现
- 实现双模式编解码器，支持灰度发布
- 建立监控机制，及时发现问题

## 五、时间计划

| 阶段 | 时间 | 任务 |
| :--- | :--- | :--- |
| 分析阶段 | 2026-02-09 | 分析冒险模块相关文件 |
| 设计阶段 | 2026-02-09 | 设计Proto文件和消息结构 |
| 实现阶段 | 2026-02-09 | 生成代码并扩展编解码器 |
| 测试阶段 | 2026-02-09 | 运行测试并验证正确性 |
| 文档阶段 | 2026-02-09 | 更新SKILL.md和迁移文档 |

## 六、风险评估

### 6.1 潜在风险

| 风险 | 影响 | 应对措施 |
| :--- | :--- | :--- |
| 冒险数据结构复杂 | 迁移难度增加 | 简化数据结构，逐步迁移 |
| 跨模块依赖 | 集成问题 | 优先迁移独立模块，再处理依赖 |
| 测试覆盖不足 | 功能回归 | 编写全面的测试用例 |

### 6.2 风险等级

- **冒险数据结构复杂**：中等
- **跨模块依赖**：低
- **测试覆盖不足**：低

## 七、预期成果

1. **成功迁移冒险模块的核心消息**
2. **新增`adventure.proto`文件定义冒险相关消息**
3. **实现冒险相关消息的编解码支持**
4. **验证跨语言通信的正确性**
5. **积累冒险模块迁移的经验**

## 八、总结

批次13迁移将专注于冒险模块（ADVENTURE）的核心消息，采用渐进式迁移策略，确保迁移过程安全、高效。通过详细的规划和测试，确保冒险模块能够顺利迁移到标准Protobuf，同时保持与其他模块的兼容性。