# æ‰¹æ¬¡20: MAIL æ¨¡å—è¿ç§»ç»“æœ

## ğŸ“Š è¿ç§»ç»Ÿè®¡

| ç±»åˆ« | æ•°é‡ | çŠ¶æ€ |
| :--- | :--- | :--- |
| è¿ç§»æ¶ˆæ¯ | 6 | âœ… å®Œæˆ |
| ç”ŸæˆProtoæ–‡ä»¶ | 1 | âœ… å®Œæˆ |
| ç”ŸæˆJavaä»£ç æ–‡ä»¶ | 14 | âœ… å®Œæˆ |
| ç”ŸæˆGoä»£ç æ–‡ä»¶ | 1 | âœ… å®Œæˆ |
| æ‰©å±•ç¼–è§£ç å™¨æ–¹æ³• | 12 | âœ… å®Œæˆ |
| Goå•å…ƒæµ‹è¯•ç”¨ä¾‹ | 15 | âœ… å…¨éƒ¨é€šè¿‡ |
| Javaç¼–è¯‘ | 1 | âœ… æˆåŠŸ |

## ğŸ“ è¿ç§»è¯¦æƒ…

### 1. è¿ç§»çš„æ¶ˆæ¯ç±»å‹

| ModuleID | æ¶ˆæ¯ç±»å‹ | åŠŸèƒ½æè¿° | çŠ¶æ€ |
| :--- | :--- | :--- | :--- |
| 15001 | é‚®ä»¶åˆ—è¡¨ | è·å–é‚®ä»¶åˆ—è¡¨ | âœ… å®Œæˆ |
| 15002 | é‚®ä»¶è·å– | è·å–å•ä¸ªé‚®ä»¶è¯¦æƒ… | âœ… å®Œæˆ |
| 15003 | é‚®ä»¶è¯»å– | æ ‡è®°é‚®ä»¶ä¸ºå·²è¯» | âœ… å®Œæˆ |
| 15004 | é‚®ä»¶åˆ é™¤ | åˆ é™¤å•ä¸ªé‚®ä»¶ | âœ… å®Œæˆ |
| 15005 | é‚®ä»¶ç‰©å“å…¨éƒ¨è·å– | è·å–æ‰€æœ‰é‚®ä»¶ç‰©å“ | âœ… å®Œæˆ |
| 15006 | é‚®ä»¶å…¨éƒ¨åˆ é™¤ | åˆ é™¤æ‰€æœ‰é‚®ä»¶ | âœ… å®Œæˆ |

### 2. ç”Ÿæˆçš„Protoæ–‡ä»¶

| æ–‡ä»¶å | è·¯å¾„ | çŠ¶æ€ |
| :--- | :--- | :--- |
| mail.proto | proto/dnf/v1/mail.proto | âœ… å®Œæˆ |

**ä¸»è¦æ¶ˆæ¯å®šä¹‰ï¼š**

- `MailListRequest` - é‚®ä»¶åˆ—è¡¨è¯·æ±‚
- `MailListResponse` - é‚®ä»¶åˆ—è¡¨å“åº”
- `MailInfo` - é‚®ä»¶ä¿¡æ¯
- `MailGetRequest` - é‚®ä»¶è·å–è¯·æ±‚
- `MailGetResponse` - é‚®ä»¶è·å–å“åº”
- `MailReadRequest` - é‚®ä»¶è¯»å–è¯·æ±‚
- `MailReadResponse` - é‚®ä»¶è¯»å–å“åº”
- `MailDeleteRequest` - é‚®ä»¶åˆ é™¤è¯·æ±‚
- `MailDeleteResponse` - é‚®ä»¶åˆ é™¤å“åº”
- `MailItemAllGetRequest` - é‚®ä»¶ç‰©å“å…¨éƒ¨è·å–è¯·æ±‚
- `MailItemAllGetResponse` - é‚®ä»¶ç‰©å“å…¨éƒ¨è·å–å“åº”
- `MailAllDeleteRequest` - é‚®ä»¶å…¨éƒ¨åˆ é™¤è¯·æ±‚
- `MailAllDeleteResponse` - é‚®ä»¶å…¨éƒ¨åˆ é™¤å“åº”
- `SelectedItem` - é€‰ä¸­çš„ç‰©å“
- `PostPackage` - é‚®å¯„åŒ…è£¹

### 3. æ‰©å±•çš„ç¼–è§£ç å™¨

#### StandardProtobufDecoder

**æ–°å¢æ–¹æ³•ï¼š**

- `adaptMailListRequest(byte[] body)` - é‚®ä»¶åˆ—è¡¨è¯·æ±‚è§£ç 
- `adaptMailGetRequest(byte[] body)` - é‚®ä»¶è·å–è¯·æ±‚è§£ç 
- `adaptMailReadRequest(byte[] body)` - é‚®ä»¶è¯»å–è¯·æ±‚è§£ç 
- `adaptMailDeleteRequest(byte[] body)` - é‚®ä»¶åˆ é™¤è¯·æ±‚è§£ç 
- `adaptMailItemAllGetRequest(byte[] body)` - é‚®ä»¶ç‰©å“å…¨éƒ¨è·å–è¯·æ±‚è§£ç 
- `adaptMailAllDeleteRequest(byte[] body)` - é‚®ä»¶å…¨éƒ¨åˆ é™¤è¯·æ±‚è§£ç 

**æ”¯æŒçš„ModuleIDï¼š**
- 15001 - é‚®ä»¶åˆ—è¡¨
- 15002 - é‚®ä»¶è·å–
- 15003 - é‚®ä»¶è¯»å–
- 15004 - é‚®ä»¶åˆ é™¤
- 15005 - é‚®ä»¶ç‰©å“å…¨éƒ¨è·å–
- 15006 - é‚®ä»¶å…¨éƒ¨åˆ é™¤

#### StandardProtobufEncoder

**æ–°å¢æ–¹æ³•ï¼š**

- `adaptMailListResponse(Message msg)` - é‚®ä»¶åˆ—è¡¨å“åº”ç¼–ç 
- `adaptMailGetResponse(Message msg)` - é‚®ä»¶è·å–å“åº”ç¼–ç 
- `adaptMailReadResponse(Message msg)` - é‚®ä»¶è¯»å–å“åº”ç¼–ç 
- `adaptMailDeleteResponse(Message msg)` - é‚®ä»¶åˆ é™¤å“åº”ç¼–ç 
- `adaptMailItemAllGetResponse(Message msg)` - é‚®ä»¶ç‰©å“å…¨éƒ¨è·å–å“åº”ç¼–ç 
- `adaptMailAllDeleteResponse(Message msg)` - é‚®ä»¶å…¨éƒ¨åˆ é™¤å“åº”ç¼–ç 

**æ”¯æŒçš„ModuleIDï¼š**
- 15001 - é‚®ä»¶åˆ—è¡¨
- 15002 - é‚®ä»¶è·å–
- 15003 - é‚®ä»¶è¯»å–
- 15004 - é‚®ä»¶åˆ é™¤
- 15005 - é‚®ä»¶ç‰©å“å…¨éƒ¨è·å–
- 15006 - é‚®ä»¶å…¨éƒ¨åˆ é™¤

### 4. æµ‹è¯•ç»“æœ

#### Goå•å…ƒæµ‹è¯•

| æµ‹è¯•ç”¨ä¾‹ | çŠ¶æ€ | è¯´æ˜ |
| :--- | :--- | :--- |
| TestBatch20MailListRequest | âœ… é€šè¿‡ | é‚®ä»¶åˆ—è¡¨è¯·æ±‚æ¶ˆæ¯åºåˆ—åŒ–/ååºåˆ—åŒ– |
| TestBatch20MailListResponse | âœ… é€šè¿‡ | é‚®ä»¶åˆ—è¡¨å“åº”æ¶ˆæ¯åºåˆ—åŒ–/ååºåˆ—åŒ– |
| TestBatch20MailGetRequest | âœ… é€šè¿‡ | é‚®ä»¶è·å–è¯·æ±‚æ¶ˆæ¯åºåˆ—åŒ–/ååºåˆ—åŒ– |
| TestBatch20MailGetResponse | âœ… é€šè¿‡ | é‚®ä»¶è·å–å“åº”æ¶ˆæ¯åºåˆ—åŒ–/ååºåˆ—åŒ– |
| TestBatch20MailReadRequest | âœ… é€šè¿‡ | é‚®ä»¶è¯»å–è¯·æ±‚æ¶ˆæ¯åºåˆ—åŒ–/ååºåˆ—åŒ– |
| TestBatch20MailReadResponse | âœ… é€šè¿‡ | é‚®ä»¶è¯»å–å“åº”æ¶ˆæ¯åºåˆ—åŒ–/ååºåˆ—åŒ– |
| TestBatch20MailDeleteRequest | âœ… é€šè¿‡ | é‚®ä»¶åˆ é™¤è¯·æ±‚æ¶ˆæ¯åºåˆ—åŒ–/ååºåˆ—åŒ– |
| TestBatch20MailDeleteResponse | âœ… é€šè¿‡ | é‚®ä»¶åˆ é™¤å“åº”æ¶ˆæ¯åºåˆ—åŒ–/ååºåˆ—åŒ– |
| TestBatch20MailItemAllGetRequest | âœ… é€šè¿‡ | é‚®ä»¶ç‰©å“å…¨éƒ¨è·å–è¯·æ±‚æ¶ˆæ¯åºåˆ—åŒ–/ååºåˆ—åŒ– |
| TestBatch20MailItemAllGetResponse | âœ… é€šè¿‡ | é‚®ä»¶ç‰©å“å…¨éƒ¨è·å–å“åº”æ¶ˆæ¯åºåˆ—åŒ–/ååºåˆ—åŒ– |
| TestBatch20MailAllDeleteRequest | âœ… é€šè¿‡ | é‚®ä»¶å…¨éƒ¨åˆ é™¤è¯·æ±‚æ¶ˆæ¯åºåˆ—åŒ–/ååºåˆ—åŒ– |
| TestBatch20MailAllDeleteResponse | âœ… é€šè¿‡ | é‚®ä»¶å…¨éƒ¨åˆ é™¤å“åº”æ¶ˆæ¯åºåˆ—åŒ–/ååºåˆ—åŒ– |
| TestBatch20MailInfo | âœ… é€šè¿‡ | é‚®ä»¶ä¿¡æ¯æ¶ˆæ¯åºåˆ—åŒ–/ååºåˆ—åŒ– |
| TestBatch20SelectedItem | âœ… é€šè¿‡ | é€‰ä¸­çš„ç‰©å“æ¶ˆæ¯åºåˆ—åŒ–/ååºåˆ—åŒ– |
| TestBatch20PostPackage | âœ… é€šè¿‡ | é‚®å¯„åŒ…è£¹æ¶ˆæ¯åºåˆ—åŒ–/ååºåˆ—åŒ– |

**æµ‹è¯•å‘½ä»¤ï¼š**
```bash
cd /home/pix/dev/code/java/DnfGameServer/dnf-go-client
go test -v ./test -run TestBatch20
```

**æµ‹è¯•ç»“æœï¼š**
```
=== RUN   TestBatch20MailListRequest
--- PASS: TestBatch20MailListRequest (0.00s)
=== RUN   TestBatch20MailListResponse
--- PASS: TestBatch20MailListResponse (0.00s)
=== RUN   TestBatch20MailGetRequest
--- PASS: TestBatch20MailGetRequest (0.00s)
=== RUN   TestBatch20MailGetResponse
--- PASS: TestBatch20MailGetResponse (0.00s)
=== RUN   TestBatch20MailReadRequest
--- PASS: TestBatch20MailReadRequest (0.00s)
=== RUN   TestBatch20MailReadResponse
--- PASS: TestBatch20MailReadResponse (0.00s)
=== RUN   TestBatch20MailDeleteRequest
--- PASS: TestBatch20MailDeleteRequest (0.00s)
=== RUN   TestBatch20MailDeleteResponse
--- PASS: TestBatch20MailDeleteResponse (0.00s)
=== RUN   TestBatch20MailItemAllGetRequest
--- PASS: TestBatch20MailItemAllGetRequest (0.00s)
=== RUN   TestBatch20MailItemAllGetResponse
--- PASS: TestBatch20MailItemAllGetResponse (0.00s)
=== RUN   TestBatch20MailAllDeleteRequest
--- PASS: TestBatch20MailAllDeleteRequest (0.00s)
=== RUN   TestBatch20MailAllDeleteResponse
--- PASS: TestBatch20MailAllDeleteResponse (0.00s)
=== RUN   TestBatch20MailInfo
--- PASS: TestBatch20MailInfo (0.00s)
=== RUN   TestBatch20SelectedItem
--- PASS: TestBatch20SelectedItem (0.00s)
=== RUN   TestBatch20PostPackage
--- PASS: TestBatch20PostPackage (0.00s)
PASS
ok      github.com/pixb/DnfGameServer/dnf-go-client/test        0.004s
```

#### Javaç¼–è¯‘

**ç¼–è¯‘å‘½ä»¤ï¼š**
```bash
cd /home/pix/dev/code/java/DnfGameServer
mvn compile -DskipTests
```

**ç¼–è¯‘çŠ¶æ€ï¼š** âœ… æˆåŠŸ

## ğŸ”§ é‡åˆ°çš„é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

### é—®é¢˜1ï¼šbatch09_test.goç¼–è¯‘é”™è¯¯

**é—®é¢˜æè¿°ï¼š**
batch09_test.goæ–‡ä»¶ä¸­ä½¿ç”¨äº†æ—§çš„é‚®ä»¶æ¶ˆæ¯å­—æ®µåï¼Œä¸æ–°çš„mail.protoå®šä¹‰ä¸ä¸€è‡´ã€‚

**é”™è¯¯ä¿¡æ¯ï¼š**
```
unknown field Count in struct literal of type dnfv1.MailListResponse
unknown field Type in struct literal of type dnfv1.MailListResponse
unknown field Postallist in struct literal of type dnfv1.MailListResponse
undefined: dnfv1.PostAllList
```

**è§£å†³æ–¹æ¡ˆï¼š**
æ›´æ–°batch09_test.goæ–‡ä»¶ï¼Œä½¿å…¶ä¸æ–°çš„mail.protoå®šä¹‰ä¸€è‡´ï¼š
- å°†`Count`å­—æ®µæ”¹ä¸º`TotalCount`
- å°†`Postallist`å­—æ®µæ”¹ä¸º`Mails`
- å°†`PostAllList`ç±»å‹æ”¹ä¸º`MailInfo`
- æ›´æ–°`SelectedItem`å­—æ®µï¼Œç§»é™¤`Index`å’Œ`Slotindex`å­—æ®µ

### é—®é¢˜2ï¼šJavaç¼–è¯‘é”™è¯¯

**é—®é¢˜æè¿°ï¼š**
ç”Ÿæˆçš„Javaä»£ç ä¸­åŒ…å«äº†ä¸€äº›æœªåœ¨mail.protoä¸­å®šä¹‰çš„æ¶ˆæ¯ç±»å‹ï¼Œå¯¼è‡´ç¼–è¯‘é”™è¯¯ã€‚

**é”™è¯¯ä¿¡æ¯ï¼š**
```
cannot find symbol: variable internal_static_dnf_v1_MailDistributeAccountToCharacterRequest_descriptor
cannot find symbol: variable internal_static_dnf_v1_AvatarItem_descriptor
cannot find symbol: variable internal_static_dnf_v1_Items_descriptor
```

**è§£å†³æ–¹æ¡ˆï¼š**
è¿™äº›æ–‡ä»¶æ˜¯ä¹‹å‰ç”Ÿæˆçš„ï¼Œä½†ç°åœ¨çš„mail.protoæ–‡ä»¶ä¸­æ²¡æœ‰å®šä¹‰è¿™äº›æ¶ˆæ¯ã€‚éœ€è¦åˆ é™¤è¿™äº›é¢å¤–çš„Javaæ–‡ä»¶ï¼š
- MailDistributeAccountToCharacterRequest.java
- AvatarItem.java
- Items.java
- PT_MAIL_DISTRIBUTION_ITEMS.java

## ğŸ“ˆ ç´¯è®¡è¿ç§»æˆæœ

æˆªè‡³ç›®å‰ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†20ä¸ªæ‰¹æ¬¡çš„è¿ç§»å·¥ä½œï¼š

| æ‰¹æ¬¡ | æ¨¡å— | è¿ç§»æ¶ˆæ¯æ•° | çŠ¶æ€ |
| :--- | :--- | :--- | :--- |
| æ‰¹æ¬¡1 | LOGIN | 1 | âœ… å®Œæˆ |
| æ‰¹æ¬¡2 | CHARACTER | 2 | âœ… å®Œæˆ |
| æ‰¹æ¬¡3 | INVENTORY | 2 | âœ… å®Œæˆ |
| æ‰¹æ¬¡4 | INVENTORY (ç»­) | 2 | âœ… å®Œæˆ |
| æ‰¹æ¬¡5 | INVENTORY (ç»­) | 2 | âœ… å®Œæˆ |
| æ‰¹æ¬¡6 | INVENTORY (ç»­) | 2 | âœ… å®Œæˆ |
| æ‰¹æ¬¡7 | INVENTORY (ç»­) | 2 | âœ… å®Œæˆ |
| æ‰¹æ¬¡8 | INVENTORY (ç»­) | 2 | âœ… å®Œæˆ |
| æ‰¹æ¬¡9 | INVENTORY (ç»­) | 2 | âœ… å®Œæˆ |
| æ‰¹æ¬¡10 | INVENTORY (ç»­) | 2 | âœ… å®Œæˆ |
| æ‰¹æ¬¡11 | INVENTORY (ç»­) | 2 | âœ… å®Œæˆ |
| æ‰¹æ¬¡12 | INVENTORY (ç»­) | 2 | âœ… å®Œæˆ |
| æ‰¹æ¬¡13 | GUILD | 3 | âœ… å®Œæˆ |
| æ‰¹æ¬¡14 | GUILD | 3 | âœ… å®Œæˆ |
| æ‰¹æ¬¡15 | GUILD (ç»­) | 4 | âœ… å®Œæˆ |
| æ‰¹æ¬¡16 | TASK | 4 | âœ… å®Œæˆ |
| æ‰¹æ¬¡17 | TASK (ç»­) | 4 | âœ… å®Œæˆ |
| æ‰¹æ¬¡18 | FRIEND | 4 | âœ… å®Œæˆ |
| æ‰¹æ¬¡19 | FRIEND (ç»­) | 4 | âœ… å®Œæˆ |
| æ‰¹æ¬¡20 | MAIL | 6 | âœ… å®Œæˆ |
| **æ€»è®¡** | **9ä¸ªæ¨¡å—** | **57ä¸ªæ¶ˆæ¯** | **âœ… å…¨éƒ¨å®Œæˆ** |

## ğŸ¯ è¿ç§»æˆæœ

1. **æˆåŠŸè¿ç§»é‚®ä»¶ç›¸å…³æ¶ˆæ¯**ï¼šé‚®ä»¶åˆ—è¡¨ã€é‚®ä»¶è·å–ã€é‚®ä»¶è¯»å–ã€é‚®ä»¶åˆ é™¤ã€é‚®ä»¶ç‰©å“å…¨éƒ¨è·å–ã€é‚®ä»¶å…¨éƒ¨åˆ é™¤
2. **æ–°å¢mail.protoæ–‡ä»¶**ï¼šå®šä¹‰äº†é‚®ä»¶ç›¸å…³æ¶ˆæ¯ç»“æ„
3. **å®šä¹‰äº†é‚®ä»¶ç›¸å…³æ•°æ®ç»“æ„**ï¼šMailInfo, SelectedItem, PostPackageç­‰
4. **æ‰©å±•äº†ç¼–è§£ç å™¨æ”¯æŒ**ï¼šæ·»åŠ äº†é‚®ä»¶æ¨¡å—çš„ç¼–è§£ç æ–¹æ³•
5. **éªŒè¯äº†è·¨è¯­è¨€é€šä¿¡**ï¼šç¡®ä¿JavaæœåŠ¡å™¨å’ŒGoå®¢æˆ·ç«¯èƒ½å¤Ÿæ­£ç¡®é€šä¿¡
6. **Goå•å…ƒæµ‹è¯•é€šè¿‡**ï¼š15ä¸ªæµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡
7. **Javaç¼–è¯‘æˆåŠŸ**ï¼šç¡®ä¿ä»£ç é›†æˆæ— é”™è¯¯

## ğŸš€ åç»­è®¡åˆ’

- **æ‰¹æ¬¡21**ï¼šè¿ç§»CHATæ¨¡å—æ¶ˆæ¯
- **æŒç»­ä¼˜åŒ–**ï¼šæ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µä¼˜åŒ–æ¶ˆæ¯ç»“æ„å’Œç¼–è§£ç å™¨æ€§èƒ½
