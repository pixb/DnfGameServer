# 批次43: 多系统迁移计划

## 基本信息

- **批次名称**: batch_43
- **批次编号**: 43
- **迁移日期**: 2026-02-10
- **总文件数**: 40
- **Proto文件**: dungeon_systems.proto

## 迁移目标

迁移40个JProtobuf文件，涵盖多个游戏系统的消息类型定义。

## 文件分类

### 1. 餐厅系统 (1个)
- PT_DINING_FOOD_BUFF_INFO - 餐厅食物Buff信息

### 2. 龙棋盘系统 (8个)
- PT_DRAGON_BOARD_APPENDAGE - 龙棋盘附加效果
- PT_DRAGON_BOARD_CHANCE_CARD - 龙棋盘机会卡
- PT_DRAGON_BOARD_CHANGE_DICE - 龙棋盘改变骰子
- PT_DRAGON_BOARD_CHANGE_SLOT - 龙棋盘改变槽位
- PT_DRAGON_BOARD_GAIN_APPENDAGE - 龙棋盘获得附加效果
- PT_DRAGON_BOARD_HOLD - 龙棋盘持有
- PT_DRAGON_BOARD_MOVE - 龙棋盘移动
- PT_DRAGON_BOARD_RESULT - 龙棋盘结果
- PT_DRAGON_BOARD_REWARD - 龙棋盘奖励

### 3. 梦境迷宫系统 (2个)
- PT_DREAM_MAZE_DUNGEON - 梦境迷宫副本
- PT_DREAM_MAZE_PLAY_MEMBER - 梦境迷宫游玩成员

### 4. 掉落系统 (1个)
- PT_DROP_OBJECT_ITEM - 掉落物品对象

### 5. 副本系统 (8个)
- PT_DUNGEONRANK - 副本排名
- PT_DUNGEON_GET_INFO - 获取副本信息
- PT_DUNGEON_PARTICIATE - 副本参与
- PT_DUNGEON_PARTY_COUNT - 副本队伍计数
- PT_DUNGEON_PARTY_COUNT2 - 副本队伍计数2
- PT_DUNGEON_RANK_INFO - 副本排名信息
- PT_DUNGEON_RESULT_QUEST_INFO - 副本结果任务信息
- PT_DUNGEON_START_INFO - 副本开始信息

### 6. 徽章系统 (3个)
- PT_EMBLEM - 徽章（已在common.proto中定义）
- PT_EMBLEM_REQUEST - 徽章请求
- PT_EMBLEM_RESULT - 徽章结果

### 7. 关卡系统 (2个)
- PT_ENTER_STAGE_MAP - 进入关卡地图
- PT_ENTER_STAGE_OBJECT - 进入关卡对象

### 8. 入口系统 (1个)
- PT_ENTRANCE_ITEM - 入口物品（已在game_systems.proto中定义）

### 9. 装备系统 (5个)
- PT_EQUIP - 装备（已在common.proto中定义）
- PT_EQUIPPED - 已装备（已在common.proto中定义）
- PT_EQUIP_INDEX_SLOT - 装备索引槽位
- PT_EQUIP_LIST - 装备列表
- PT_EQUIP_PUT_ON_OFF - 装备穿戴/脱下

### 10. 差事系统 (3个)
- PT_ERRAND_CLEAR - 差事清除（已在gameplay_systems.proto中定义）
- PT_ERRAND_INFO - 差事信息（已在gameplay_systems.proto中定义）
- PT_ERRAND_TODAY - 今日差事（已在gameplay_systems.proto中定义）

### 11. 护送系统 (4个)
- PT_ESCORT_CLEAR_REWARD - 护送清除奖励
- PT_ESCORT_CURRENT_REWARD - 护送当前奖励
- PT_ESCORT_DONE_READY - 护送完成准备
- PT_ESCORT_REWARD - 护送奖励

## 迁移步骤

1. **分析文件结构**: 分析每个JProtobuf文件的字段类型和依赖关系
2. **创建Proto定义**: 创建dungeon_systems.proto文件，定义所有消息类型
3. **解决依赖问题**: 处理与其他proto文件的依赖关系
4. **生成代码**: 使用buf工具生成Java和Go代码
5. **编写测试**: 编写单元测试验证序列化和反序列化
6. **验证编译**: 验证Java代码编译成功
7. **更新跟踪**: 更新迁移跟踪系统

## 预期结果

- 成功迁移40个JProtobuf文件
- 生成完整的Java和Go代码
- 所有测试通过
- Java编译成功

## 注意事项

1. 部分消息类型已在其他proto文件中定义（如PT_DRAGON_BOARD_MEMBER、PT_EMBLEM、PT_EQUIP、PT_EQUIPPED、PT_ENTRANCE_ITEM、PT_ERRAND_CLEAR、PT_ERRAND_INFO、PT_ERRAND_TODAY）
2. 需要正确处理嵌套消息类型（如PT_DRAGON_BOARD_CHANCE_CARD包含多个其他消息类型）
3. 需要处理重复字段（如PT_EMBLEM中的acqtime字段没有@Protobuf注解）
4. 需要处理List类型字段（如PT_DUNGEON_START_INFO中的users和detail）
5. 需要定义一些辅助类型（如PT_USER_MINIMUM_INFO、PT_STATE_OBJECT_DROP等）
