# Protobuf迁移文档

本目录包含从JProtobuf重构到标准Protobuf的所有相关文档。

## 文档列表

### 00. 协议整理
| 序号 | 文档名称 | 说明 |
|------|---------|------|
| 00 | [protobuf协议整理](./00_protobuf协议整理.md) | 整理和分析现有的protobuf协议文件 |

### 01. 架构分析
| 序号 | 文档名称 | 说明 |
|------|---------|------|
| 01-01 | [架构概述](./01_01_架构概述.md) | Protobuf技术栈和整体架构 |
| 01-02 | [核心组件](./01_02_核心组件.md) | Message、@MessageMeta、SerializerHelper等核心组件 |
| 01-03 | [消息类型](./01_03_消息类型.md) | 消息命名规范、模块划分、消息处理流程 |

### 02. 重构指南
| 序号 | 文档名称 | 说明 |
|------|---------|------|
| 02-01 | [重构背景与目标](./02_01_重构背景与目标.md) | 为什么需要重构、重构目标和优势 |
| 02-02 | [重构方案](./02_02_重构方案.md) | 整体架构、重构步骤、迁移计划 |
| 02-03 | [类型映射](./02_03_类型映射.md) | JProtobuf到标准Protobuf的类型映射规则 |
| 02-04 | [文件组织](./02_04_文件组织.md) | Proto文件目录结构、命名规范、buf配置 |
| 02-05 | [代码生成与集成](./02_05_代码生成与集成.md) | 安装protoc、生成代码、集成到Java项目 |
| 02-06 | [测试与验证](./02_06_测试与验证.md) | 单元测试、集成测试、性能测试、渐进式迁移 |

## 迁移背景

当前项目使用百度JProtobuf实现，存在以下问题：
- 仅支持Java语言，无法跨语言通信
- 使用私有实现，不符合Google Protobuf标准
- 工具链限制，无法使用buf、protoc等标准工具
- 社区支持较小，问题解决困难

## 迁移目标

通过重构到标准Protobuf，实现：
- 跨语言支持（Java、Go、Python、TypeScript等）
- 符合Google Protobuf标准，生态完善
- 可使用buf、protoc等成熟工具链
- 性能优化和长期维护保障

## 相关资源

- [Proto目录规划](../../proto/README.md) - Proto文件的组织结构和规范
- [模块映射表](../../proto/MODULE_MAPPING.md) - 模块号与功能模块的对应关系
- [Go项目Proto规范](../../.trae/skills/go-project-proto/SKILL.md) - Go项目的Proto使用规范

## 快速开始

1. 阅读文档了解当前架构和问题
2. 参考重构方案制定迁移计划
3. **每次只迁移1-2个文件**，不要一次性迁移所有文件
4. 按照Proto目录规范创建.proto文件
5. 使用protoc或buf工具生成代码
6. 集成到项目中并立即测试
7. 测试通过后再迁移下一个文件

## 渐进式迁移原则

**重要**：本迁移必须遵循渐进式原则，避免一次性改动过大：

### 迁移流程
```
选择1-2个文件 → 手动转换.proto → 生成代码 → 单元测试 → 集成测试 → 通过？
                                                              ↓
                                                            是 → 迁移下一批文件
                                                              ↓
                                                            否 → 回滚并修复
```

### 核心原则
1. **每次只迁移1-2个文件**，不要使用Python脚本一次性迁移
2. **手动转换**，确保每个字段都正确映射
3. **转换后立即测试**，不要等待所有文件转换完成
4. **测试通过后再继续**，避免累积错误
5. **保持新旧代码共存**，通过配置快速切换
6. **出现问题立即回滚**，不要继续迁移

### 推荐迁移顺序
1. **第1批**：登录相关（LOGIN）
2. **第2批**：角色相关（CHARACTER）
3. **第3批**：物品相关（ITEM）
4. **第4批**：技能相关（SKILL）
5. **第5批**：副本相关（DUNGEON）
6. **后续批次**：根据业务需求逐步迁移

### 配置切换
通过配置文件控制使用新旧协议：
```yaml
protobuf:
  mode: hybrid  # jprotobuf | standard | hybrid
  migrated_modules:
    - LOGIN
    - CHARACTER
```

## 注意事项

- **严禁使用Python脚本一次性迁移所有文件**
- **每次迁移后必须立即测试**
- **保留JProtobuf代码作为回退方案**
- **充分测试确保兼容性**
- **采用灰度发布策略降低风险**
- **记录每次迁移的结果和问题**
