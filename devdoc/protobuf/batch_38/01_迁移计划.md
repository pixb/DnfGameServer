# 第38批迁移计划

## 迁移目标

本次迁移将处理以下JProtobuf文件，这些文件涉及用户界面、系统命令、商店、票务、赛季通行证等多个系统：

### 用户相关消息
1. **PT_WATING_LIST_USER_INFO** - 等待列表用户信息
2. **PT_USER_NAME** - 用户名称
3. **PT_USER_MINIMUM_INFO** - 用户最小信息
4. **PT_USER_LOADING_STATUS** - 用户加载状态
5. **PT_SIMPLE_CHARACTER** - 简单角色信息
6. **PT_USER_BOARD_GAME_RESULT** - 用户棋盘游戏结果

### 房间和队伍相关
7. **PT_ROOM_USER_INFO** - 房间用户信息
8. **PT_TEAM_RESULT** - 队伍结果

### 商店相关
9. **PT_SHOP_TAB_RESET** - 商店标签重置
10. **PT_SHOP_BUY_COUNT** - 商店购买计数

### 票务和奖励相关
11. **PT_TICKET** - 票务信息
12. **PT_TICKET_REWARD_INFO** - 票务奖励信息
13. **PT_TOWER_REWARD_ITEMS** - 塔奖励物品
14. **PT_TIME_ATTACK_REWARD** - 时间攻击奖励
15. **PT_SHARE_REWARD_INFO** - 分享奖励信息

### 皮肤相关
16. **PT_SKIN_ITEM** - 皮肤物品
17. **PT_SKIN_CHAT_INFO** - 皮肤聊天信息
18. **PT_SKIN_EQUIP_PUT_ON_OFF** - 皮肤装备穿戴/脱下

### 教程相关
19. **PT_TUTORIAL** - 教程信息

### 系统命令相关
20. **PT_SYSTEM_COMMAND** - 系统命令（主消息）
21. **PT_SYSCMD_COMMAND** - 系统命令命令
22. **PT_SYSCMD_COMMAND_TAKE_ITEM** - 系统命令获取物品
23. **PT_SYSCMD_ITEMJSON** - 系统命令物品JSON
24. **PT_SYSCMD_CERASHOP** - 系统命令Cera商店
25. **PT_SYSCMD_PACKAGES** - 系统命令包
26. **PT_SYSCMD_PARTY** - 系统命令队伍
27. **PT_SYSCMD_MASTERBUFF** - 系统命令大师Buff

### 其他系统
28. **PT_WHISPER_CHAT** - 私聊
29. **PT_USE_INHERIT_TYPE** - 使用继承类型
30. **PT_WAREHOUSE_NPC** - 仓库NPC
31. **PT_WAREHOUSE_STRUCTURE** - 仓库结构
32. **PT_WORLDRADE_REWARD** - 世界交易奖励
33. **PT_WELFARE_FIND_REWARD_INFO** - 福利查找奖励信息
34. **PT_USABLE_FACILITY_INFO** - 可用设施信息
35. **PT_SERIA_BUFF_MATERIAL** - Seria Buff材料
36. **PT_SERIA_BUFF_INFO** - Seria Buff信息
37. **PT_SD_DEATH_MATCH_REWARD** - SD死亡匹配奖励
38. **PT_SD_BATTLEROYAL_RECORD** - SD大逃杀记录
39. **PT_TOWN_INTERVAL** - 城镇间隔
40. **PT_SUBDUE_INFO** - 征讨信息
41. **PT_STATE_OBJECT_DROP** - 状态对象掉落
42. **PT_SPECIAL_TILE_INFO** - 特殊地块信息
43. **PT_SEASONPASS** - 赛季通行证
44. **PT_TOY_BILLING_VERIFY** - 玩具计费验证

## 迁移步骤

### 步骤1：分析JProtobuf文件结构
- 分析每个JProtobuf类的字段类型和注解
- 确定字段顺序和类型映射关系
- 识别嵌套消息和枚举类型

### 步骤2：创建Protobuf定义文件
- 创建`user_systems.proto`文件
- 定义所有消息类型
- 添加必要的导入语句
- 确保类型映射正确

### 步骤3：生成代码
- 使用buf工具生成Java代码
- 使用buf工具生成Go代码
- 验证代码生成成功

### 步骤4：编写测试
- 为每个消息类型编写Go单元测试
- 测试序列化和反序列化
- 验证字段正确性

### 步骤5：验证编译
- 验证Java代码编译成功
- 验证Go代码编译成功
- 运行所有测试

### 步骤6：更新迁移跟踪系统
- 记录迁移的文件数量
- 记录迁移的消息类型数量
- 更新迁移进度

### 步骤7：创建迁移结果文档
- 记录迁移详情
- 记录遇到的问题和解决方案
- 提供迁移总结

## 预期结果

- 成功迁移44个JProtobuf文件
- 创建1个Protobuf定义文件（user_systems.proto）
- 生成Java和Go代码
- 所有测试通过
- Java和Go代码编译成功

## 注意事项

1. **PT_SYSTEM_COMMAND**是一个大型消息，包含84个字段，需要仔细处理
2. 需要检查依赖的消息类型是否已定义（如PT_EQUIP、PT_STACKABLE等）
3. 枚举类型需要正确映射到Protobuf枚举
4. 注意字段类型的正确转换（如UINT64、INT64等）
5. 需要确保所有嵌套消息都已正确定义

## 依赖关系

需要导入的.proto文件：
- `common.proto` - 包含基础类型定义
- `welfare.proto` - 包含SkinItem等类型
- `gamesystems.proto` - 可能包含相关类型
- `social_events.proto` - 可能包含相关类型

## 迁移时间估计

- 分析文件结构：30分钟
- 创建Protobuf定义文件：45分钟
- 生成代码：15分钟
- 编写测试：60分钟
- 验证编译：30分钟
- 更新跟踪系统：15分钟
- 创建结果文档：15分钟

总计：约3小时
