# 5. 数据库设计文档

## 5.1 表结构

### 5.1.1 商城商品表 (t_online_mall_item)
| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| `id` | `BIGINT` | `PRIMARY KEY AUTO_INCREMENT` | 商品ID |
| `name` | `VARCHAR(100)` | `NOT NULL` | 商品名称 |
| `description` | `VARCHAR(500)` | `NOT NULL` | 商品描述 |
| `itemType` | `INT` | `NOT NULL INDEX` | 商品类型 |
| `itemIndex` | `INT` | `NOT NULL` | 物品索引 |
| `itemCount` | `INT` | `NOT NULL` | 物品数量 |
| `bind` | `BOOLEAN` | `NOT NULL DEFAULT FALSE` | 是否绑定 |
| `price` | `BIGINT` | `NOT NULL` | 价格 |
| `currencyType` | `INT` | `NOT NULL` | 货币类型 |
| `originalPrice` | `INT` | `NOT NULL DEFAULT 0` | 原价 |
| `saleQuota` | `INT` | `NOT NULL DEFAULT 0` | 销售配额 |
| `saleCount` | `INT` | `NOT NULL DEFAULT 0` | 已销售数量 |
| `forSale` | `BOOLEAN` | `NOT NULL DEFAULT TRUE INDEX` | 是否在售 |
| `recommend` | `BOOLEAN` | `NOT NULL DEFAULT FALSE INDEX` | 是否推荐 |
| `page` | `INT` | `NOT NULL DEFAULT 1` | 页码 |
| `barcode` | `VARCHAR(50)` | `DEFAULT NULL` | 条形码 |
| `startTime` | `DATETIME` | `NOT NULL` | 开始时间 |
| `endTime` | `DATETIME` | `NOT NULL` | 结束时间 |
| `buyLimit` | `INT` | `NOT NULL DEFAULT 0` | 购买限制 |
| `unit` | `VARCHAR(20)` | `NOT NULL DEFAULT '个'` | 单位 |
| `sort` | `INT` | `NOT NULL DEFAULT 0` | 排序 |
| `createTime` | `DATETIME` | `NOT NULL DEFAULT CURRENT_TIMESTAMP` | 创建时间 |
| `updateTime` | `DATETIME` | `NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP` | 更新时间 |

### 5.1.2 商城购买记录表 (t_online_mall_buy_record)
| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| `id` | `BIGINT` | `PRIMARY KEY AUTO_INCREMENT` | 记录ID |
| `roleId` | `BIGINT` | `NOT NULL INDEX` | 角色ID |
| `itemId` | `INT` | `NOT NULL INDEX` | 商品ID |
| `itemName` | `VARCHAR(100)` | `NOT NULL` | 商品名称 |
| `itemCount` | `INT` | `NOT NULL` | 购买数量 |
| `price` | `BIGINT` | `NOT NULL` | 购买价格 |
| `currencyType` | `INT` | `NOT NULL` | 货币类型 |
| `buyTime` | `DATETIME` | `NOT NULL INDEX` | 购买时间 |
| `createTime` | `DATETIME` | `NOT NULL DEFAULT CURRENT_TIMESTAMP` | 创建时间 |

### 5.1.3 商城分类表 (t_online_mall_category)
| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| `id` | `BIGINT` | `PRIMARY KEY AUTO_INCREMENT` | 分类ID |
| `name` | `VARCHAR(50)` | `NOT NULL` | 分类名称 |
| `parentId` | `INT` | `NOT NULL DEFAULT 0 INDEX` | 父分类ID |
| `sort` | `INT` | `NOT NULL DEFAULT 0` | 排序 |
| `status` | `INT` | `NOT NULL DEFAULT 1` | 状态 |
| `createTime` | `DATETIME` | `NOT NULL DEFAULT CURRENT_TIMESTAMP` | 创建时间 |
| `updateTime` | `DATETIME` | `NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP` | 更新时间 |

### 5.1.4 商城购买限制表 (t_online_mall_buy_limit)
| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| `id` | `BIGINT` | `PRIMARY KEY AUTO_INCREMENT` | 限制ID |
| `roleId` | `BIGINT` | `NOT NULL INDEX` | 角色ID |
| `itemId` | `INT` | `NOT NULL INDEX` | 商品ID |
| `buyCount` | `INT` | `NOT NULL DEFAULT 0` | 购买数量 |
| `buyDate` | `DATE` | `NOT NULL INDEX` | 购买日期 |
| `createTime` | `DATETIME` | `NOT NULL DEFAULT CURRENT_TIMESTAMP` | 创建时间 |
| `updateTime` | `DATETIME` | `NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP` | 更新时间 |

## 5.2 索引设计
- **t_online_mall_item**: 为 `itemType`、`forSale`、`recommend` 字段创建索引，优化查询性能
- **t_online_mall_buy_record**: 为 `roleId`、`itemId`、`buyTime` 字段创建索引，优化查询性能
- **t_online_mall_category**: 为 `parentId` 字段创建索引，优化分类查询
- **t_online_mall_buy_limit**: 为 `roleId`、`itemId`、`buyDate` 字段创建联合索引，优化购买限制检查