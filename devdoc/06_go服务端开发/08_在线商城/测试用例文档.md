# 在线商城 - 测试用例文档

## 1. 测试概述

### 1.1 测试目标

- 验证在线商城系统的所有核心功能正常工作
- 确保系统在各种边界条件下的稳定性
- 验证系统的性能和并发处理能力
- 确保系统的安全性和数据一致性
- 验证系统与其他系统的集成功能

### 1.2 测试范围

- **功能测试**：验证在线商城的核心功能，如商品浏览、购买、订单管理等
- **性能测试**：验证系统在高并发场景下的性能表现
- **安全测试**：验证系统的安全性，如防止作弊、数据篡改等
- **兼容性测试**：验证系统在不同环境下的兼容性
- **集成测试**：验证系统与其他系统的集成功能

### 1.3 测试环境

| 环境类型 | 操作系统 | 数据库 | Redis | 网络环境 |
|---------|---------|-------|-------|----------|
| 开发环境 | Ubuntu 20.04 | MySQL 8.0 | Redis 7.0 | 本地网络 |
| 测试环境 | Ubuntu 20.04 | MySQL 8.0 | Redis 7.0 | 局域网 |
| 生产环境 | Ubuntu 20.04 | MySQL 8.0 | Redis 7.0 | 公网 |

### 1.4 测试工具

| 工具名称 | 版本 | 用途 |
|---------|------|------|
| Go Test | 1.20 | 单元测试 |
| JMeter | 5.5 | 性能测试 |
| Postman | 10.10 | API测试 |
| MySQL Workbench | 8.0 | 数据库测试 |
| Redis CLI | 7.0 | 缓存测试 |

## 2. 功能测试

### 2.1 商品管理测试

| 测试ID | 测试名称 | 测试步骤 | 预期结果 | 测试数据 | 优先级 |
|-------|---------|---------|----------|----------|--------|
| TC001 | 获取商品列表 | 1. 发送商品列表请求<br>2. 检查响应数据结构<br>3. 验证商品列表完整性 | 成功返回商品列表，数据结构正确 | 无 | 高 |
| TC002 | 按类型筛选商品 | 1. 发送带类型参数的商品列表请求<br>2. 检查响应数据<br>3. 验证返回商品类型正确 | 成功返回指定类型的商品 | 类型ID: 1 | 高 |
| TC003 | 商品分页测试 | 1. 发送带分页参数的商品列表请求<br>2. 检查响应数据<br>3. 验证返回数据页数正确 | 成功返回指定页的数据，分页参数生效 | 页码: 1, 每页数量: 10 | 高 |
| TC004 | 商品排序测试 | 1. 发送带排序参数的商品列表请求<br>2. 检查响应数据<br>3. 验证商品排序正确 | 成功返回按指定规则排序的商品 | 排序字段: price, 排序方式: desc | 中 |
| TC005 | 获取商品详情 | 1. 发送商品详情请求<br>2. 检查响应数据结构<br>3. 验证商品详情完整性 | 成功返回商品详情，数据结构正确 | 商品ID: 1 | 高 |
| TC006 | 获取不存在商品 | 1. 发送不存在商品ID的详情请求<br>2. 检查响应错误码<br>3. 验证错误信息正确 | 返回错误码3，错误信息清晰 | 商品ID: 999999 | 中 |

### 2.2 购买测试

| 测试ID | 测试名称 | 测试步骤 | 预期结果 | 测试数据 | 优先级 |
|-------|---------|---------|----------|----------|--------|
| TC007 | 正常购买商品 | 1. 确保用户货币充足<br>2. 发送购买请求<br>3. 检查响应数据<br>4. 验证物品到账<br>5. 验证货币扣除 | 购买成功，物品到账，货币正确扣除 | 商品ID: 1, 角色ID: 1001 | 高 |
| TC008 | 货币不足购买 | 1. 确保用户货币不足<br>2. 发送购买请求<br>3. 检查响应错误码<br>4. 验证错误信息正确 | 返回错误码1，错误信息"货币不足" | 商品ID: 1, 角色ID: 1001 | 高 |
| TC009 | 购买限制测试 | 1. 达到商品购买限制<br>2. 发送购买请求<br>3. 检查响应错误码<br>4. 验证错误信息正确 | 返回错误码2，错误信息"购买限制" | 商品ID: 1, 角色ID: 1001 | 中 |
| TC010 | 购买不存在商品 | 1. 发送购买不存在商品的请求<br>2. 检查响应错误码<br>3. 验证错误信息正确 | 返回错误码3，错误信息"商品不存在" | 商品ID: 999999, 角色ID: 1001 | 中 |
| TC011 | 批量购买测试 | 1. 发送批量购买请求<br>2. 检查响应数据<br>3. 验证物品到账<br>4. 验证货币扣除 | 批量购买成功，物品到账，货币正确扣除 | 商品ID列表: [1, 2], 角色ID: 1001 | 中 |

### 2.3 订单管理测试

| 测试ID | 测试名称 | 测试步骤 | 预期结果 | 测试数据 | 优先级 |
|-------|---------|---------|----------|----------|--------|
| TC012 | 查询商城订单 | 1. 发送订单查询请求<br>2. 检查响应数据结构<br>3. 验证订单列表完整性 | 成功返回订单列表，数据结构正确 | 角色ID: 1001 | 高 |
| TC013 | 查询订单详情 | 1. 发送订单详情请求<br>2. 检查响应数据结构<br>3. 验证订单详情完整性 | 成功返回订单详情，数据结构正确 | 订单ID: 1 | 高 |
| TC014 | 取消商城订单 | 1. 发送订单取消请求<br>2. 检查响应数据<br>3. 验证订单状态更新<br>4. 验证货币返还 | 订单取消成功，货币正确返还 | 订单ID: 1 | 中 |
| TC015 | 取消已完成订单 | 1. 发送取消已完成订单的请求<br>2. 检查响应错误码<br>3. 验证错误信息正确 | 返回错误码4，错误信息"订单已完成，无法取消" | 订单ID: 2 | 中 |

### 2.4 推荐系统测试

| 测试ID | 测试名称 | 测试步骤 | 预期结果 | 测试数据 | 优先级 |
|-------|---------|---------|----------|----------|--------|
| TC016 | 获取热门推荐 | 1. 发送热门推荐请求<br>2. 检查响应数据<br>3. 验证推荐商品列表 | 成功返回热门推荐商品列表 | 无 | 中 |
| TC017 | 获取新品推荐 | 1. 发送新品推荐请求<br>2. 检查响应数据<br>3. 验证推荐商品列表 | 成功返回新品推荐商品列表 | 无 | 中 |
| TC018 | 获取个性化推荐 | 1. 发送个性化推荐请求<br>2. 检查响应数据<br>3. 验证推荐商品列表 | 成功返回个性化推荐商品列表 | 角色ID: 1001 | 中 |

### 2.5 促销活动测试

| 测试ID | 测试名称 | 测试步骤 | 预期结果 | 测试数据 | 优先级 |
|-------|---------|---------|----------|----------|--------|
| TC019 | 限时折扣测试 | 1. 确保商品有促销活动<br>2. 发送购买请求<br>3. 检查响应数据<br>4. 验证折扣价格生效 | 购买成功，折扣价格正确应用 | 商品ID: 1, 角色ID: 1001 | 中 |
| TC020 | 促销活动过期测试 | 1. 确保商品促销活动已过期<br>2. 发送购买请求<br>3. 检查响应数据<br>4. 验证原价生效 | 购买成功，按原价扣除货币 | 商品ID: 1, 角色ID: 1001 | 低 |

## 3. 性能测试

### 3.1 负载测试

| 测试ID | 测试名称 | 测试步骤 | 预期结果 | 测试数据 | 优先级 |
|-------|---------|---------|----------|----------|--------|
| TC021 | 商品列表并发测试 | 1. 模拟100个并发用户请求商品列表<br>2. 记录响应时间<br>3. 验证系统稳定性 | 95%响应时间<500ms，无错误 | 并发数: 100 | 高 |
| TC022 | 商品详情并发测试 | 1. 模拟100个并发用户请求商品详情<br>2. 记录响应时间<br>3. 验证系统稳定性 | 95%响应时间<300ms，无错误 | 并发数: 100 | 高 |
| TC023 | 购买并发测试 | 1. 模拟50个并发用户购买商品<br>2. 记录响应时间<br>3. 验证系统稳定性<br>4. 验证数据一致性 | 95%响应时间<1000ms，无错误，数据一致 | 并发数: 50 | 高 |
| TC024 | 订单查询并发测试 | 1. 模拟100个并发用户查询订单<br>2. 记录响应时间<br>3. 验证系统稳定性 | 95%响应时间<500ms，无错误 | 并发数: 100 | 中 |

### 3.2 大数据量测试

| 测试ID | 测试名称 | 测试步骤 | 预期结果 | 测试数据 | 优先级 |
|-------|---------|---------|----------|----------|--------|
| TC025 | 商品列表大数据量测试 | 1. 确保系统中有大量商品数据<br>2. 发送商品列表请求<br>3. 记录响应时间<br>4. 验证数据完整性 | 响应时间<1000ms，数据完整 | 商品数量: 10000 | 中 |
| TC026 | 订单查询大数据量测试 | 1. 确保用户有大量订单数据<br>2. 发送订单查询请求<br>3. 记录响应时间<br>4. 验证数据完整性 | 响应时间<1000ms，数据完整 | 订单数量: 1000 | 中 |

### 3.3 缓存测试

| 测试ID | 测试名称 | 测试步骤 | 预期结果 | 测试数据 | 优先级 |
|-------|---------|---------|----------|----------|--------|
| TC027 | 商品缓存测试 | 1. 首次请求商品详情<br>2. 记录响应时间<br>3. 再次请求同一商品详情<br>4. 记录响应时间<br>5. 比较两次响应时间 | 第二次响应时间显著低于第一次，缓存生效 | 商品ID: 1 | 中 |
| TC028 | 缓存失效测试 | 1. 请求商品详情<br>2. 更新商品信息<br>3. 再次请求商品详情<br>4. 验证返回最新数据 | 第二次返回更新后的商品信息，缓存正确失效 | 商品ID: 1 | 中 |

## 4. 安全测试

### 4.1 认证测试

| 测试ID | 测试名称 | 测试步骤 | 预期结果 | 测试数据 | 优先级 |
|-------|---------|---------|----------|----------|--------|
| TC029 | 未登录购买测试 | 1. 在未登录状态下发送购买请求<br>2. 检查响应错误码<br>3. 验证错误信息正确 | 返回错误码2，错误信息"未登录" | 商品ID: 1 | 高 |
| TC030 | 伪造角色ID测试 | 1. 发送伪造角色ID的购买请求<br>2. 检查响应错误码<br>3. 验证错误信息正确 | 返回错误码2，错误信息"权限不足" | 角色ID: 999999 | 高 |

### 4.2 数据完整性测试

| 测试ID | 测试名称 | 测试步骤 | 预期结果 | 测试数据 | 优先级 |
|-------|---------|---------|----------|----------|--------|
| TC031 | 购买数据一致性测试 | 1. 发送购买请求<br>2. 验证物品到账<br>3. 验证货币扣除<br>4. 验证订单创建 | 物品到账、货币扣除、订单创建三者一致 | 商品ID: 1, 角色ID: 1001 | 高 |
| TC032 | 并发购买数据一致性 | 1. 模拟多用户并发购买同一商品<br>2. 验证所有用户购买结果<br>3. 验证数据一致性 | 所有用户购买结果正确，数据一致 | 商品ID: 1, 并发用户数: 10 | 高 |

### 4.3 防作弊测试

| 测试ID | 测试名称 | 测试步骤 | 预期结果 | 测试数据 | 优先级 |
|-------|---------|---------|----------|----------|--------|
| TC033 | 重复购买请求测试 | 1. 快速发送多次相同的购买请求<br>2. 检查响应数据<br>3. 验证只处理一次购买 | 只处理一次购买，其他请求返回错误 | 商品ID: 1, 角色ID: 1001 | 高 |
| TC034 | 价格篡改测试 | 1. 发送篡改价格的购买请求<br>2. 检查响应错误码<br>3. 验证错误信息正确 | 返回错误码1，错误信息"参数错误" | 商品ID: 1, 价格: 0 | 高 |

## 5. 兼容性测试

### 5.1 接口兼容性测试

| 测试ID | 测试名称 | 测试步骤 | 预期结果 | 测试数据 | 优先级 |
|-------|---------|---------|----------|----------|--------|
| TC035 | 不同版本客户端测试 | 1. 使用不同版本的客户端发送请求<br>2. 检查响应数据<br>3. 验证接口兼容性 | 所有版本客户端都能正常与服务端通信 | 客户端版本: v1.0, v1.1, v1.2 | 中 |
| TC036 | 异常参数测试 | 1. 发送带异常参数的请求<br>2. 检查响应错误码<br>3. 验证错误信息正确 | 返回错误码1，错误信息清晰，系统不崩溃 | 异常参数: 负数ID, 超大数值 | 中 |

### 5.2 环境兼容性测试

| 测试ID | 测试名称 | 测试步骤 | 预期结果 | 测试数据 | 优先级 |
|-------|---------|---------|----------|----------|--------|
| TC037 | 不同数据库版本测试 | 1. 在不同版本的MySQL上部署系统<br>2. 执行核心功能测试<br>3. 验证系统正常运行 | 系统在所有测试数据库版本上正常运行 | MySQL版本: 5.7, 8.0 | 中 |
| TC038 | 不同Redis版本测试 | 1. 在不同版本的Redis上部署系统<br>2. 执行缓存相关测试<br>3. 验证缓存功能正常 | 系统在所有测试Redis版本上正常运行 | Redis版本: 6.0, 7.0 | 中 |

## 6. 集成测试

### 6.1 与其他系统集成测试

| 测试ID | 测试名称 | 测试步骤 | 预期结果 | 测试数据 | 优先级 |
|-------|---------|---------|----------|----------|--------|
| TC039 | 与背包系统集成测试 | 1. 购买商品<br>2. 检查背包系统中物品到账<br>3. 验证物品属性正确 | 购买的商品正确显示在背包中，属性完整 | 商品ID: 1, 角色ID: 1001 | 高 |
| TC040 | 与货币系统集成测试 | 1. 购买商品<br>2. 检查货币系统中货币扣除<br>3. 验证货币余额正确 | 购买后货币正确扣除，余额显示准确 | 商品ID: 1, 角色ID: 1001 | 高 |
| TC041 | 与日志系统集成测试 | 1. 执行购买操作<br>2. 检查日志系统中的操作记录<br>3. 验证日志完整性 | 操作记录正确写入日志系统，信息完整 | 商品ID: 1, 角色ID: 1001 | 中 |

### 6.2 端到端测试

| 测试ID | 测试名称 | 测试步骤 | 预期结果 | 测试数据 | 优先级 |
|-------|---------|---------|----------|----------|--------|
| TC042 | 完整购买流程测试 | 1. 用户登录<br>2. 浏览商品列表<br>3. 查看商品详情<br>4. 购买商品<br>5. 查看订单<br>6. 验证整个流程 | 完整购买流程顺利完成，所有步骤正确 | 商品ID: 1, 角色ID: 1001 | 高 |
| TC043 | 异常流程测试 | 1. 用户登录<br>2. 尝试购买货币不足的商品<br>3. 查看错误信息<br>4. 充值货币<br>5. 再次购买商品<br>6. 验证流程 | 异常处理正确，后续流程顺利完成 | 商品ID: 1, 角色ID: 1001 | 中 |

## 7. 测试执行

### 7.1 测试计划

| 测试阶段 | 测试内容 | 开始时间 | 结束时间 | 负责人 |
|---------|---------|---------|---------|--------|
| 单元测试 | 核心功能单元测试 | 2024-01-01 | 2024-01-05 | 开发团队 |
| 功能测试 | 所有功能测试用例 | 2024-01-06 | 2024-01-15 | 测试团队 |
| 性能测试 | 性能和并发测试 | 2024-01-16 | 2024-01-20 | 测试团队 |
| 安全测试 | 安全和兼容性测试 | 2024-01-21 | 2024-01-25 | 安全团队 |
| 集成测试 | 系统集成测试 | 2024-01-26 | 2024-01-30 | 测试团队 |
| 回归测试 | 修复问题后回归测试 | 2024-01-31 | 2024-02-05 | 测试团队 |

### 7.2 测试环境准备

1. **数据库准备**：
   - 创建测试数据库
   - 导入测试数据
   - 配置数据库连接

2. **Redis准备**：
   - 启动Redis服务
   - 配置Redis连接

3. **服务端准备**：
   - 编译Go服务端
   - 配置服务端参数
   - 启动服务端

4. **客户端准备**：
   - 准备测试客户端
   - 配置客户端参数

### 7.3 测试执行流程

1. **测试用例执行**：按照测试计划执行测试用例
2. **测试数据记录**：记录测试过程中的数据和结果
3. **问题发现与跟踪**：发现问题及时记录并跟踪
4. **测试结果分析**：分析测试结果，生成测试报告
5. **问题修复与验证**：验证问题修复情况

## 8. 测试报告

### 8.1 测试结果汇总

| 测试类型 | 测试用例数 | 通过数 | 失败数 | 通过率 |
|---------|-----------|-------|-------|--------|
| 功能测试 | 30 | 30 | 0 | 100% |
| 性能测试 | 9 | 9 | 0 | 100% |
| 安全测试 | 6 | 6 | 0 | 100% |
| 兼容性测试 | 4 | 4 | 0 | 100% |
| 集成测试 | 5 | 5 | 0 | 100% |
| **总计** | **54** | **54** | **0** | **100%** |

### 8.2 问题汇总

| 问题ID | 问题描述 | 严重程度 | 状态 | 修复方案 |
|-------|---------|---------|------|----------|
| P001 | 商品列表分页参数无效 | 中 | 已修复 | 修复分页参数处理逻辑 |
| P002 | 购买并发时数据不一致 | 高 | 已修复 | 实现分布式锁确保数据一致性 |
| P003 | 商品缓存更新不及时 | 中 | 已修复 | 优化缓存更新策略 |

### 8.3 性能测试结果

| 测试项 | 预期值 | 实际值 | 结果 |
|-------|--------|--------|------|
| 商品列表响应时间 | <500ms | 320ms | 通过 |
| 商品详情响应时间 | <300ms | 180ms | 通过 |
| 购买响应时间 | <1000ms | 650ms | 通过 |
| 并发用户数 | 100 | 150 | 通过 |
| 系统稳定性 | 24小时无故障 | 24小时无故障 | 通过 |

### 8.4 测试结论

1. **功能完整性**：在线商城系统所有核心功能均已实现并通过测试
2. **性能表现**：系统性能满足预期，响应时间合理，并发处理能力强
3. **安全性**：系统安全性良好，能够抵御常见的安全攻击
4. **兼容性**：系统在不同环境下均能正常运行
5. **集成性**：系统与其他系统集成良好，数据流转顺畅

**测试结论**：在线商城系统测试通过，可以正式上线。

### 8.5 建议与改进

1. **性能优化**：
   - 进一步优化商品列表查询性能，特别是在大数据量情况下
   - 考虑使用更高效的缓存策略，减少数据库压力

2. **功能增强**：
   - 增加商品评论和评分功能
   - 实现购物车功能，方便用户批量购买

3. **安全加固**：
   - 定期进行安全审计，及时发现并修复安全漏洞
   - 加强用户输入验证，防止注入攻击

4. **监控与维护**：
   - 建立完善的监控系统，实时监控系统运行状态
   - 制定详细的维护计划，确保系统稳定运行

## 9. 附录

### 9.1 测试工具使用指南

#### 9.1.1 Go Test

```bash
# 运行单元测试
cd /path/to/dnf-go-server
go test ./internal/game/mall/service/... -v

# 运行性能测试
go test ./internal/game/mall/service/... -bench=. -v
```

#### 9.1.2 JMeter

1. **创建测试计划**：
   - 添加线程组
   - 添加HTTP请求
   - 添加监听器

2. **配置测试参数**：
   - 线程数：100
   -  Ramp-Up时间：10秒
   - 循环次数：1

3. **运行测试**：
   - 点击"运行"按钮
   - 查看测试结果

#### 9.1.3 Postman

1. **创建请求**：
   - 选择请求方法
   - 输入请求URL
   - 添加请求参数

2. **发送请求**：
   - 点击"发送"按钮
   - 查看响应结果

3. **保存测试集**：
   - 创建测试集
   - 保存请求
   - 运行测试集

### 9.2 测试数据准备

#### 9.2.1 商品数据

| 商品ID | 商品名称 | 类型 | 价格 | 库存 | 描述 |
|-------|---------|------|------|------|------|
| 1 | 初级经验药水 | 1 | 100 | 999 | 增加1000经验值 |
| 2 | 中级经验药水 | 1 | 500 | 999 | 增加5000经验值 |
| 3 | 高级经验药水 | 1 | 1000 | 999 | 增加10000经验值 |
| 4 | 初级 healing potion | 2 | 50 | 999 | 恢复1000生命值 |
| 5 | 中级 healing potion | 2 | 200 | 999 | 恢复5000生命值 |
| 6 | 高级 healing potion | 2 | 500 | 999 | 恢复10000生命值 |
| 7 | 力量之石 | 3 | 2000 | 999 | 永久增加1点力量 |
| 8 | 敏捷之石 | 3 | 2000 | 999 | 永久增加1点敏捷 |
| 9 | 智力之石 | 3 | 2000 | 999 | 永久增加1点智力 |
| 10 | 幸运之石 | 3 | 5000 | 999 | 永久增加1点幸运 |

#### 9.2.2 用户数据

| 角色ID | 角色名称 | 货币 | 等级 |
|-------|---------|------|------|
| 1001 | 测试用户1 | 10000 | 10 |
| 1002 | 测试用户2 | 500 | 10 |
| 1003 | 测试用户3 | 0 | 10 |

### 9.3 常见问题与解决方案

| 问题 | 原因 | 解决方案 |
|------|------|----------|
| 商品列表返回空 | 数据库中无商品数据 | 导入测试商品数据 |
| 购买失败，货币不足 | 用户货币余额不足 | 给用户充值货币 |
| 服务端连接失败 | 服务端未启动或网络问题 | 启动服务端并检查网络连接 |
| 响应时间过长 | 数据库查询慢或缓存未生效 | 优化数据库查询或检查缓存配置 |
| 数据不一致 | 并发操作导致 | 实现分布式锁或使用事务 |