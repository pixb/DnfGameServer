# PK系统测试用例文档

## 1. 测试概览

PK系统测试的目的是验证系统的核心功能是否正常工作，包括PK场匹配、战斗计算、荣誉值管理、排行榜等功能。测试将覆盖正常场景、边界场景和异常场景，确保系统的稳定性和可靠性。

## 2. 测试环境

| 环境 | 配置 | 说明 |
| :--- | :--- | :--- |
| 操作系统 | Linux CentOS 7.6 | 服务器操作系统 |
| 数据库 | MySQL 8.0 | 存储PK记录和玩家数据 |
| 缓存 | Redis 7.0 | 存储匹配队列和排行榜 |
| 消息队列 | Kafka 3.0 | 处理异步任务 |
| Go版本 | Go 1.20 | 开发语言 |
| Gin版本 | v1.9.0 | Web框架 |
| 测试工具 | Postman | API测试工具 |
| 压力测试工具 | JMeter | 性能测试工具 |

## 3. 测试用例

### 3.1 PK场进入测试

| 测试用例ID | 测试用例名称 | 测试步骤 | 预期结果 | 实际结果 | 状态 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| TC_PK_001 | 正常进入PK场 | 1. 发送PK申请请求，包含有效玩家ID、等级、匹配值<br>2. 检查响应状态码和数据 | 1. 响应状态码为200<br>2. 响应数据包含queueId、position、status字段<br>3. status为"queued" | | |
| TC_PK_002 | 缺少参数进入PK场 | 1. 发送PK申请请求，缺少玩家ID参数<br>2. 检查响应状态码和数据 | 1. 响应状态码为400<br>2. 响应消息为"参数错误" | | |
| TC_PK_003 | 无效玩家ID进入PK场 | 1. 发送PK申请请求，使用无效玩家ID<br>2. 检查响应状态码和数据 | 1. 响应状态码为404<br>2. 响应消息为"玩家不存在" | | |
| TC_PK_004 | 等级过低进入PK场 | 1. 发送PK申请请求，使用等级为0的玩家<br>2. 检查响应状态码和数据 | 1. 响应状态码为400<br>2. 响应消息为"等级过低，无法进入PK场" | | |

### 3.2 PK匹配测试

| 测试用例ID | 测试用例名称 | 测试步骤 | 预期结果 | 实际结果 | 状态 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| TC_PK_005 | 正常匹配测试 | 1. 发送两个PK申请请求，使用等级和匹配值相近的玩家<br>2. 等待匹配服务执行<br>3. 检查是否匹配成功 | 1. 两个玩家成功匹配<br>2. 收到匹配成功通知<br>3. 匹配到的对手信息正确 | | |
| TC_PK_006 | 等级差距匹配测试 | 1. 发送两个PK申请请求，使用等级差距较大的玩家<br>2. 等待匹配服务执行<br>3. 检查是否匹配成功 | 1. 两个玩家匹配失败<br>2. 继续等待匹配 | | |
| TC_PK_007 | 匹配超时测试 | 1. 发送PK申请请求，使用唯一等级的玩家<br>2. 等待超过最大匹配时间<br>3. 检查是否匹配超时 | 1. 收到匹配超时通知<br>2. 玩家从匹配队列中移除 | | |
| TC_PK_008 | 取消匹配测试 | 1. 发送PK申请请求<br>2. 发送取消匹配请求<br>3. 检查是否成功取消 | 1. 收到取消匹配成功通知<br>2. 玩家从匹配队列中移除 | | |

### 3.3 PK战斗测试

| 测试用例ID | 测试用例名称 | 测试步骤 | 预期结果 | 实际结果 | 状态 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| TC_PK_009 | 正常战斗测试 | 1. 模拟两个玩家匹配成功<br>2. 发送战斗开始请求<br>3. 发送多个战斗操作请求<br>4. 发送战斗结束请求<br>5. 检查战斗结果 | 1. 战斗成功开始<br>2. 战斗操作正常处理<br>3. 战斗成功结束<br>4. 战斗结果正确 | | |
| TC_PK_010 | 战斗超时测试 | 1. 模拟两个玩家匹配成功<br>2. 发送战斗开始请求<br>3. 等待超过战斗超时时间<br>4. 检查战斗结果 | 1. 战斗超时结束<br>2. 基于生命值判定胜负 | | |
| TC_PK_011 | 网络异常战斗测试 | 1. 模拟两个玩家匹配成功<br>2. 发送战斗开始请求<br>3. 模拟一方网络异常<br>4. 检查战斗结果 | 1. 战斗正常结束<br>2. 网络异常方判定为失败 | | |
| TC_PK_012 | 战斗操作频率测试 | 1. 模拟两个玩家匹配成功<br>2. 发送战斗开始请求<br>3. 短时间内发送大量战斗操作请求<br>4. 检查服务器处理情况 | 1. 服务器正常处理请求<br>2. 没有出现错误或崩溃 | | |

### 3.4 荣誉值管理测试

| 测试用例ID | 测试用例名称 | 测试步骤 | 预期结果 | 实际结果 | 状态 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| TC_PK_013 | 正常荣誉值计算测试 | 1. 模拟一场PK战斗<br>2. 发送战斗结束请求，包含战斗结果、连击数等信息<br>3. 检查荣誉值计算结果 | 1. 荣誉值计算正确<br>2. 胜利者荣誉值增加<br>3. 失败者荣誉值减少 | | |
| TC_PK_014 | 等级差距荣誉值测试 | 1. 模拟一场等级差距较大的PK战斗<br>2. 发送战斗结束请求<br>3. 检查荣誉值计算结果 | 1. 等级低的玩家击败等级高的玩家获得更多荣誉值<br>2. 等级高的玩家击败等级低的玩家获得较少荣誉值 | | |
| TC_PK_015 | 连击加成荣誉值测试 | 1. 模拟一场连击数较高的PK战斗<br>2. 发送战斗结束请求，包含高连击数<br>3. 检查荣誉值计算结果 | 1. 荣誉值计算包含连击加成<br>2. 连击数越高，荣誉值加成越多 | | |
| TC_PK_016 | 荣誉等级更新测试 | 1. 模拟多场PK战斗，使玩家荣誉值达到等级升级条件<br>2. 检查玩家荣誉等级 | 1. 玩家荣誉等级正确更新<br>2. 等级名称正确显示 | | |

### 3.5 排行榜测试

| 测试用例ID | 测试用例名称 | 测试步骤 | 预期结果 | 实际结果 | 状态 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| TC_PK_017 | 排行榜获取测试 | 1. 发送排行榜获取请求<br>2. 检查排行榜数据 | 1. 响应状态码为200<br>2. 响应数据包含玩家排名、荣誉值、等级等信息<br>3. 玩家按荣誉值降序排列 | | |
| TC_PK_018 | 排行榜更新测试 | 1. 模拟一场PK战斗，使玩家荣誉值变化<br>2. 发送排行榜获取请求<br>3. 检查玩家排名 | 1. 玩家排名正确更新<br>2. 其他玩家排名相应调整 | | |
| TC_PK_019 | 玩家排名获取测试 | 1. 发送玩家排名获取请求，包含玩家ID<br>2. 检查响应数据 | 1. 响应状态码为200<br>2. 响应数据包含玩家排名、荣誉值、等级字段 | | |
| TC_PK_020 | 排行榜缓存测试 | 1. 发送排行榜获取请求，记录响应时间<br>2. 再次发送相同请求，记录响应时间<br>3. 比较两次响应时间 | 1. 第二次响应时间明显短于第一次<br>2. 响应数据一致 | | |

### 3.6 PK记录测试

| 测试用例ID | 测试用例名称 | 测试步骤 | 预期结果 | 实际结果 | 状态 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| TC_PK_021 | PK记录保存测试 | 1. 模拟一场PK战斗<br>2. 发送战斗结束请求<br>3. 检查数据库中的PK记录 | 1. 数据库中存在对应的PK记录<br>2. 记录字段值正确 | | |
| TC_PK_022 | PK记录查询测试 | 1. 发送PK记录查询请求，包含玩家ID<br>2. 检查响应状态码和数据 | 1. 响应状态码为200<br>2. 响应数据包含玩家的PK记录列表<br>3. 记录按时间倒序排列 | | |
| TC_PK_023 | PK记录分页测试 | 1. 发送PK记录查询请求，包含玩家ID和分页参数<br>2. 检查响应数据 | 1. 响应数据包含指定数量的PK记录<br>2. 分页功能正常 | | |
| TC_PK_024 | 不存在玩家PK记录查询测试 | 1. 发送PK记录查询请求，使用不存在的玩家ID<br>2. 检查响应状态码和数据 | 1. 响应状态码为404<br>2. 响应消息为"玩家不存在" | | |

### 3.7 玩家PK信息测试

| 测试用例ID | 测试用例名称 | 测试步骤 | 预期结果 | 实际结果 | 状态 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| TC_PK_025 | 正常获取玩家PK信息 | 1. 发送玩家PK信息查询请求，包含有效玩家ID<br>2. 检查响应状态码和数据 | 1. 响应状态码为200<br>2. 响应数据包含playerId、honor、honorLevel、totalBattles、wins、losses、draws、winRate字段<br>3. 字段值正确 | | |
| TC_PK_026 | 不存在玩家PK信息查询 | 1. 发送玩家PK信息查询请求，使用不存在的玩家ID<br>2. 检查响应状态码和数据 | 1. 响应状态码为404<br>2. 响应消息为"玩家不存在" | | |
| TC_PK_027 | 新玩家PK信息查询 | 1. 发送玩家PK信息查询请求，使用新创建的玩家ID<br>2. 检查响应状态码和数据 | 1. 响应状态码为200<br>2. 响应数据包含默认值：honor为0，honorLevel为1，totalBattles为0，wins为0，losses为0，draws为0，winRate为0 | | |

### 3.8 异常场景测试

| 测试用例ID | 测试用例名称 | 测试步骤 | 预期结果 | 实际结果 | 状态 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| TC_PK_028 | 服务器内部错误测试 | 1. 模拟服务器内部错误场景<br>2. 发送PK申请请求<br>3. 检查响应状态码和数据 | 1. 响应状态码为500<br>2. 响应消息为"服务器内部错误" | | |
| TC_PK_029 | 并发请求测试 | 1. 同时发送多个PK申请请求<br>2. 检查响应状态码和数据<br>3. 检查服务器是否正常运行 | 1. 所有请求都得到正确响应<br>2. 服务器正常运行，无崩溃 | | |
| TC_PK_030 | 重复进入PK场测试 | 1. 发送PK申请请求<br>2. 在未取消前再次发送相同的PK申请请求<br>3. 检查响应状态码和数据 | 1. 第二次响应状态码为409<br>2. 响应消息为"玩家已在匹配队列中" | | |

## 4. 性能测试

### 4.1 测试目标

- 验证系统在高并发情况下的稳定性
- 测试系统的响应时间
- 测试系统的吞吐量
- 测试系统的资源使用情况

### 4.2 测试场景

| 测试场景 | 并发用户数 | 持续时间 | 测试接口 | 预期结果 |
| :--- | :--- | :--- | :--- | :--- |
| 正常负载测试 | 100 | 5分钟 | /api/pk/queue | 1. 响应时间<500ms<br>2. 成功率>99%<br>3. 服务器CPU使用率<70%<br>4. 内存使用率<80% |
| 高负载测试 | 500 | 5分钟 | /api/pk/queue | 1. 响应时间<1000ms<br>2. 成功率>95%<br>3. 服务器CPU使用率<80%<br>4. 内存使用率<85% |
| 极限负载测试 | 1000 | 5分钟 | /api/pk/queue | 1. 响应时间<2000ms<br>2. 成功率>90%<br>3. 服务器稳定运行，无崩溃 |
| 战斗操作测试 | 200 | 5分钟 | /api/pk/battle/action | 1. 响应时间<300ms<br>2. 成功率>99% |
| 排行榜查询测试 | 300 | 5分钟 | /api/pk/ranking | 1. 响应时间<200ms<br>2. 成功率>99% |

### 4.3 测试结果分析

| 测试场景 | 并发用户数 | 平均响应时间 | 成功率 | CPU使用率 | 内存使用率 | 结论 |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| 正常负载测试 | 100 | | | | | |
| 高负载测试 | 500 | | | | | |
| 极限负载测试 | 1000 | | | | | |
| 战斗操作测试 | 200 | | | | | |
| 排行榜查询测试 | 300 | | | | | |

## 5. 安全测试

### 5.1 测试目标

- 验证系统的安全性
- 测试系统对常见攻击的防御能力
- 测试系统的权限控制

### 5.2 测试用例

| 测试用例ID | 测试用例名称 | 测试步骤 | 预期结果 | 实际结果 | 状态 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| TC_PK_SEC_001 | SQL注入测试 | 1. 发送包含SQL注入语句的PK申请请求<br>2. 检查响应状态码和数据 | 1. 响应状态码为400<br>2. 响应消息为"参数错误"<br>3. 服务器无异常 | | |
| TC_PK_SEC_002 | XSS攻击测试 | 1. 发送包含XSS攻击代码的PK申请请求<br>2. 检查响应状态码和数据 | 1. 响应状态码为400<br>2. 响应消息为"参数错误"<br>3. 服务器无异常 | | |
| TC_PK_SEC_003 | 未授权访问测试 | 1. 发送PK申请请求，不包含认证信息<br>2. 检查响应状态码和数据 | 1. 响应状态码为401<br>2. 响应消息为"未授权" | | |
| TC_PK_SEC_004 | 权限控制测试 | 1. 使用普通玩家账号发送管理接口请求<br>2. 检查响应状态码和数据 | 1. 响应状态码为403<br>2. 响应消息为"禁止访问" | | |
| TC_PK_SEC_005 | 频率限制测试 | 1. 短时间内发送大量相同的PK申请请求<br>2. 检查响应状态码和数据 | 1. 前几次响应状态码为200<br>2. 后续响应状态码为429<br>3. 响应消息为"请求过于频繁" | | |

## 6. 测试结果汇总

### 6.1 功能测试结果

| 测试模块 | 测试用例数 | 通过数 | 失败数 | 通过率 |
| :--- | :--- | :--- | :--- | :--- |
| PK场进入测试 | 4 | | | |
| PK匹配测试 | 4 | | | |
| PK战斗测试 | 4 | | | |
| 荣誉值管理测试 | 4 | | | |
| 排行榜测试 | 4 | | | |
| PK记录测试 | 4 | | | |
| 玩家PK信息测试 | 3 | | | |
| 异常场景测试 | 3 | | | |
| **总计** | **30** | | | |

### 6.2 性能测试结果

| 测试场景 | 预期结果 | 实际结果 | 状态 |
| :--- | :--- | :--- | :--- |
| 正常负载测试 | 1. 响应时间<500ms<br>2. 成功率>99%<br>3. 服务器CPU使用率<70%<br>4. 内存使用率<80% | | |
| 高负载测试 | 1. 响应时间<1000ms<br>2. 成功率>95%<br>3. 服务器CPU使用率<80%<br>4. 内存使用率<85% | | |
| 极限负载测试 | 1. 响应时间<2000ms<br>2. 成功率>90%<br>3. 服务器稳定运行，无崩溃 | | |
| 战斗操作测试 | 1. 响应时间<300ms<br>2. 成功率>99% | | |
| 排行榜查询测试 | 1. 响应时间<200ms<br>2. 成功率>99% | | |

### 6.3 安全测试结果

| 测试用例ID | 测试用例名称 | 预期结果 | 实际结果 | 状态 |
| :--- | :--- | :--- | :--- | :--- |
| TC_PK_SEC_001 | SQL注入测试 | 1. 响应状态码为400<br>2. 响应消息为"参数错误"<br>3. 服务器无异常 | | |
| TC_PK_SEC_002 | XSS攻击测试 | 1. 响应状态码为400<br>2. 响应消息为"参数错误"<br>3. 服务器无异常 | | |
| TC_PK_SEC_003 | 未授权访问测试 | 1. 响应状态码为401<br>2. 响应消息为"未授权" | | |
| TC_PK_SEC_004 | 权限控制测试 | 1. 响应状态码为403<br>2. 响应消息为"禁止访问" | | |
| TC_PK_SEC_005 | 频率限制测试 | 1. 前几次响应状态码为200<br>2. 后续响应状态码为429<br>3. 响应消息为"请求过于频繁" | | |

## 7. 缺陷分析

### 7.1 功能缺陷

| 缺陷ID | 缺陷描述 | 严重程度 | 修复状态 | 修复建议 |
| :--- | :--- | :--- | :--- | :--- |
| | | | | |
| | | | | |
| | | | | |

### 7.2 性能缺陷

| 缺陷ID | 缺陷描述 | 严重程度 | 修复状态 | 修复建议 |
| :--- | :--- | :--- | :--- | :--- |
| | | | | |
| | | | | |
| | | | | |

### 7.3 安全缺陷

| 缺陷ID | 缺陷描述 | 严重程度 | 修复状态 | 修复建议 |
| :--- | :--- | :--- | :--- | :--- |
| | | | | |
| | | | | |
| | | | | |

## 8. 测试结论

| 测试类型 | 结论 | 建议 |
| :--- | :--- | :--- |
| 功能测试 | | |
| 性能测试 | | |
| 安全测试 | | |
| 总体测试 | | |

## 9. 测试总结

1. **测试覆盖情况**:
   - 覆盖了PK系统的所有核心功能
   - 覆盖了正常场景、边界场景和异常场景
   - 覆盖了性能测试和安全测试

2. **测试结果分析**:
   - 功能测试：
   - 性能测试：
   - 安全测试：

3. **系统稳定性**:
   - 在正常负载下，系统运行稳定
   - 在高负载下，系统响应时间略有增加，但仍在可接受范围内
   - 在极限负载下，系统仍能保持稳定运行

4. **系统安全性**:
   - 系统对SQL注入、XSS攻击等常见攻击有防御能力
   - 系统实现了未授权访问控制和权限控制
   - 系统实现了请求频率限制，防止恶意请求

5. **改进建议**:
   - 功能改进：
   - 性能改进：
   - 安全改进：

6. **测试建议**:
   - 定期进行回归测试，确保系统功能正常
   - 定期进行性能测试，确保系统性能满足需求
   - 定期进行安全测试，确保系统安全可靠
   - 增加自动化测试，提高测试效率