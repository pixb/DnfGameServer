# 市场系统 - Java代码分析

## 1. 核心控制器

| 控制器类 | 主要功能 | 关键方法 |
| :--- | :--- | :--- |
| `MarketController` | 市场系统主控制器 | `handleMarketList`, `handleMarketAdd`, `handleMarketRemove`, `handleMarketBuy`, `handleMarketSearch`, `handleMarketMyList` |

## 2. 核心功能

### 2.1 市场列表查询

**功能描述**：查询市场中的物品列表，支持分页、筛选和排序

**请求处理**：`REQ_MARKET_LIST`

**核心逻辑**：
1. 验证请求参数
2. 查询市场物品
3. 分页处理
4. 返回物品列表

### 2.2 物品上架

**功能描述**：玩家将物品上架到市场，设置价格和数量

**请求处理**：`REQ_MARKET_ADD`

**核心逻辑**：
1. 验证物品存在性
2. 验证物品所有权
3. 从背包移除物品
4. 添加到市场

### 2.3 物品下架

**功能描述**：玩家下架自己的物品，将物品重新收回背包

**请求处理**：`REQ_MARKET_REMOVE`

**核心逻辑**：
1. 验证市场物品存在性
2. 验证物品所有权
3. 将物品返回到背包
4. 删除市场物品

### 2.4 物品购买

**功能描述**：玩家购买市场中的物品，自动完成交易流程

**请求处理**：`REQ_MARKET_BUY`

**核心逻辑**：
1. 验证市场物品存在性
2. 验证买家货币
3. 扣除买家货币
4. 添加物品到买家背包
5. 添加货币到卖家
6. 更新市场物品状态
7. 记录交易

### 2.5 市场搜索

**功能描述**：搜索市场中的物品，支持按名称、类型、等级和价格范围搜索

**请求处理**：`REQ_MARKET_SEARCH`

**核心逻辑**：
1. 验证搜索参数
2. 执行搜索操作
3. 分页处理
4. 返回搜索结果

### 2.6 我的上架列表

**功能描述**：查询玩家自己上架的物品，管理上架状态

**请求处理**：`REQ_MARKET_MY_LIST`

**核心逻辑**：
1. 验证角色身份
2. 查询玩家上架的物品
3. 分页处理
4. 返回上架列表