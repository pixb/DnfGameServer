# 市场系统 - 数据库设计文档

## 1. 表结构

### 1.1 市场物品表 (`t_market_item`)

| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| `id` | `BIGINT UNSIGNED` | `PRIMARY KEY AUTO_INCREMENT` | 市场物品ID |
| `sellerGuid` | `BIGINT UNSIGNED` | `NOT NULL INDEX` | 卖家角色ID |
| `sellerName` | `VARCHAR(50)` | `NOT NULL` | 卖家角色名称 |
| `itemGuid` | `BIGINT UNSIGNED` | `NOT NULL UNIQUE INDEX` | 物品GUID |
| `itemIndex` | `INT UNSIGNED` | `NOT NULL INDEX` | 物品索引 |
| `itemCount` | `INT UNSIGNED` | `NOT NULL` | 物品数量 |
| `bind` | `BOOLEAN` | `NOT NULL DEFAULT FALSE` | 是否绑定 |
| `quality` | `INT UNSIGNED` | `NOT NULL` | 物品品质 |
| `level` | `INT UNSIGNED` | `NOT NULL INDEX` | 物品等级 |
| `price` | `BIGINT UNSIGNED` | `NOT NULL INDEX` | 物品价格 |
| `currencyType` | `INT UNSIGNED` | `NOT NULL` | 货币类型 |
| `status` | `INT UNSIGNED` | `NOT NULL DEFAULT 0` | 状态（0-上架中，1-已卖出，2-已下架） |
| `createTime` | `DATETIME` | `NOT NULL DEFAULT CURRENT_TIMESTAMP` | 创建时间 |
| `expireTime` | `DATETIME` | `NOT NULL INDEX` | 过期时间 |
| `updateTime` | `DATETIME` | `NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP` | 更新时间 |

### 1.2 市场交易记录表 (`t_market_record`)

| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| `id` | `BIGINT UNSIGNED` | `PRIMARY KEY AUTO_INCREMENT` | 交易记录ID |
| `marketId` | `BIGINT UNSIGNED` | `NOT NULL INDEX` | 市场物品ID |
| `sellerGuid` | `BIGINT UNSIGNED` | `NOT NULL INDEX` | 卖家角色ID |
| `buyerGuid` | `BIGINT UNSIGNED` | `NOT NULL INDEX` | 买家角色ID |
| `itemGuid` | `BIGINT UNSIGNED` | `NOT NULL` | 物品GUID |
| `itemIndex` | `INT UNSIGNED` | `NOT NULL` | 物品索引 |
| `itemCount` | `INT UNSIGNED` | `NOT NULL` | 物品数量 |
| `price` | `BIGINT UNSIGNED` | `NOT NULL` | 交易价格 |
| `currencyType` | `INT UNSIGNED` | `NOT NULL` | 货币类型 |
| `tax` | `BIGINT UNSIGNED` | `NOT NULL` | 交易税收 |
| `tradeTime` | `DATETIME` | `NOT NULL DEFAULT CURRENT_TIMESTAMP` | 交易时间 |
| `createTime` | `DATETIME` | `NOT NULL DEFAULT CURRENT_TIMESTAMP` | 创建时间 |

## 2. 索引设计

| 表名 | 索引名 | 索引类型 | 索引字段 | 描述 |
| :--- | :--- | :--- | :--- | :--- |
| `t_market_item` | `idx_seller_guid` | `BTREE` | `sellerGuid` | 加速卖家物品查询 |
| `t_market_item` | `idx_item_guid` | `BTREE` | `itemGuid` | 加速物品唯一性验证 |
| `t_market_item` | `idx_item_index` | `BTREE` | `itemIndex` | 加速物品类型查询 |
| `t_market_item` | `idx_level` | `BTREE` | `level` | 加速等级范围查询 |
| `t_market_item` | `idx_price` | `BTREE` | `price` | 加速价格范围查询 |
| `t_market_item` | `idx_expire_time` | `BTREE` | `expireTime` | 加速过期物品清理 |
| `t_market_record` | `idx_market_id` | `BTREE` | `marketId` | 加速交易记录查询 |
| `t_market_record` | `idx_seller_guid` | `BTREE` | `sellerGuid` | 加速卖家交易记录查询 |
| `t_market_record` | `idx_buyer_guid` | `BTREE` | `buyerGuid` | 加速买家交易记录查询 |