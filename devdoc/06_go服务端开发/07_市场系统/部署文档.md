# 市场系统 - 部署文档

## 1. 环境要求

| 依赖 | 版本/范围 | 用途 | 安装命令 |
| :--- | :--- | :--- | :--- |
| `Go` | `1.20+` | 开发和运行环境 | `apt install golang-go` |
| `MySQL` | `5.7+` | 数据库 | `apt install mysql-server` |
| `Redis` | `6.0+` | 缓存 | `apt install redis-server` |
| `buf` | `1.0+` | ProtoBuf 代码生成 | `npm install -g @bufbuild/buf` |

## 2. 安装步骤

### 2.1 安装依赖

```bash
# 安装 Go
apt install golang-go

# 安装 MySQL
apt install mysql-server

# 安装 Redis
apt install redis-server

# 安装 buf
npm install -g @bufbuild/buf
```

### 2.2 配置数据库

```bash
# 登录 MySQL
mysql -u root -p

# 创建数据库
CREATE DATABASE dnf_game_server;

# 创建用户并授权
CREATE USER 'dnf'@'localhost' IDENTIFIED BY 'password';
GRANT ALL PRIVILEGES ON dnf_game_server.* TO 'dnf'@'localhost';
FLUSH PRIVILEGES;

# 创建市场系统表
source sql/market_system.sql;
```

### 2.3 部署服务

```bash
# 克隆代码
git clone https://github.com/pixb/DnfGameServer.git
cd DnfGameServer/dnf-go-server

# 生成 ProtoBuf 代码
make generate

# 编译服务
make build

# 启动服务
make start
```

## 3. 配置说明

| 配置项 | 类型 | 默认值 | 说明 | 所属文件/模块 |
| :--- | :--- | :--- | :--- | :--- |
| `ServerPort` | `int` | `8081` | 服务器端口 | `config/config.go` |
| `MySQLDSN` | `string` | `dnf:password@tcp(localhost:3306)/dnf_game_server?charset=utf8mb4&parseTime=True&loc=Local` | MySQL 连接字符串 | `config/config.go` |
| `RedisAddr` | `string` | `localhost:6379` | Redis 地址 | `config/config.go` |
| `LogLevel` | `string` | `info` | 日志级别 | `config/config.go` |
| `MarketItemExpireDays` | `int` | `7` | 市场物品过期天数 | `config/config.go` |
| `MarketTaxRate` | `float64` | `0.05` | 市场交易税率 | `config/config.go` |