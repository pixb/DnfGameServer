# 制作系统 - 业务流程文档

## 1. 物品制作流程

### 1.1 流程步骤

1. **验证请求**
   - 检查角色是否登录
   - 验证配方是否存在
   - 验证技能等级是否足够
   - 验证材料是否充足

2. **执行制作**
   - 消耗所需材料
   - 计算制作成功率
   - 根据成功率决定是否成功
   - 生成成品（如果成功）

3. **更新状态**
   - 增加技能经验
   - 记录制作历史
   - 处理技能升级

4. **返回响应**
   - 返回制作结果
   - 返回获得的物品

## 2. 制作技能升级流程

### 2.1 流程步骤

1. **验证请求**
   - 检查角色是否登录
   - 查询当前技能等级和经验

2. **计算升级**
   - 计算当前经验是否达到升级要求
   - 计算升级后剩余经验

3. **执行升级**
   - 更新技能等级
   - 更新剩余经验
   - 解锁新配方

4. **返回响应**
   - 返回新的技能等级
   - 返回剩余经验

## 3. 批量制作流程

### 3.1 流程步骤

1. **验证请求**
   - 检查角色是否登录
   - 验证配方是否存在
   - 验证技能等级是否足够
   - 验证批量材料是否充足

2. **执行批量制作**
   - 批量消耗所需材料
   - 逐个计算制作成功率
   - 逐个决定是否成功
   - 批量生成成品（如果成功）

3. **更新状态**
   - 累计增加技能经验
   - 批量记录制作历史
   - 处理技能升级

4. **返回响应**
   - 返回批量制作结果
   - 返回获得的物品总数

## 4. 状态转换

| 状态 | 触发条件 | 转换动作 | 目标状态 |
| :--- | :--- | :--- | :--- |
| 初始状态 | 制作请求 | 验证材料和技能 | 制作中 |
| 制作中 | 制作成功 | 生成物品，增加经验 | 制作完成 |
| 制作中 | 制作失败 | 消耗材料，少量增加经验 | 制作完成 |
| 技能等级N | 经验达到升级要求 | 升级技能等级 | 技能等级N+1 |