# 系统设计文档模板

## 1. 系统概述

### 1.1 系统简介
- 系统名称：[系统名称]
- 系统功能：[系统主要功能描述]
- 系统位置：[系统在整体架构中的位置]

### 1.2 核心流程
- [核心流程描述]
- [核心流程示意图]

## 2. Java 代码分析

### 2.1 核心控制器
- **文件位置**: [Java 控制器文件路径]
- **处理器数量**: [@RequestMapping 方法数量]

### 2.2 核心功能

#### 2.2.1 [功能名称 1]
- **方法**: [方法名称]
- **功能**:
  - [功能描述 1]
  - [功能描述 2]
- **参数**:
  - [参数 1]: [参数描述]
  - [参数 2]: [参数描述]
- **返回数据**:
  - [返回字段 1]: [字段描述]
  - [返回字段 2]: [字段描述]

#### 2.2.2 [功能名称 2]
- **方法**: [方法名称]
- **功能**:
  - [功能描述 1]
  - [功能描述 2]
- **参数**:
  - [参数 1]: [参数描述]
  - [参数 2]: [参数描述]
- **返回数据**:
  - [返回字段 1]: [字段描述]
  - [返回字段 2]: [字段描述]

## 3. Go 实现方案

### 3.1 ProtoBuf 消息定义

#### [proto 文件名]
```protobuf
syntax = "proto3";

package dnf.v1;

option go_package = "gen/dnf/v1";

import "dnf/v1/common.proto";

// [请求消息名称]
message [RequestMessageName] {
    [字段类型] [字段名] = [字段编号];
    [字段类型] [字段名] = [字段编号];
}

// [响应消息名称]
message [ResponseMessageName] {
    [字段类型] [字段名] = [字段编号];
    [字段类型] [字段名] = [字段编号];
}
```

### 3.2 服务端实现

#### 3.2.1 控制器
```go
package [package name]

import (
    "context"
    "fmt"

    "github.com/pixb/DnfGameServer/dnf-go-server/gen/dnf/v1"
    "github.com/pixb/DnfGameServer/dnf-go-server/store"
)

// [ControllerName] 控制器
type [ControllerName] struct {
    store *store.Store
}

// New[ControllerName] 创建控制器实例
func New[ControllerName](store *store.Store) *[ControllerName] {
    return &[ControllerName]{store: store}
}

// [MethodName] 处理 [功能名称] 请求
func (c *[ControllerName]) [MethodName](ctx context.Context, req *v1.[RequestMessageName]) (*v1.[ResponseMessageName], error) {
    // 业务逻辑
    return &v1.[ResponseMessageName]{}, nil
}
```

#### 3.2.2 路由注册
```go
package [package name]

import (
    "github.com/labstack/echo/v4"
    "github.com/pixb/DnfGameServer/dnf-go-server/gen/dnf/v1"
    "github.com/pixb/DnfGameServer/dnf-go-server/server/router/api/v1"
    "google.golang.org/grpc"
)

// RegisterRoutes 注册路由
func (s *[ServiceName]) RegisterRoutes(e *echo.Echo) {
    // HTTP 路由
    e.POST("/api/v1/[path]", s.[MethodName])
}

// RegisterGRPCServices 注册 gRPC 服务
func (s *[ServiceName]) RegisterGRPCServices(server *grpc.Server) {
    v1.Register[ServiceName]Server(server, s)
}
```

## 4. API 文档

### 4.1 HTTP API

#### 4.1.1 [API 路径 1]
- **URL**: `/api/v1/[path]`
- **方法**: POST
- **请求参数**:
  | 参数名 | 类型 | 必需 | 描述 |
  |--------|------|------|------|
  | [参数 1] | [类型] | [是/否] | [描述] |
  | [参数 2] | [类型] | [是/否] | [描述] |
- **响应格式**:
  ```json
  {
    "error": [错误码],
    "message": "[错误消息]",
    "data": {
      [响应字段 1]: [值],
      [响应字段 2]: [值]
    }
  }
  ```

### 4.2 gRPC API

#### 4.2.1 [方法名称 1]
- **服务**: [服务名称]
- **方法**: [方法名称]
- **请求消息**:
  ```protobuf
  [RequestMessageName] {
    [字段名]: [值]
  }
  ```
- **响应消息**:
  ```protobuf
  [ResponseMessageName] {
    [字段名]: [值]
  }
  ```

## 5. 数据库设计文档

### 5.1 表结构

#### [表名 1]
| 字段名 | 数据类型 | 约束 | 描述 |
|--------|----------|------|------|
| [字段 1] | [类型] | [约束] | [描述] |
| [字段 2] | [类型] | [约束] | [描述] |

#### [表名 2]
| 字段名 | 数据类型 | 约束 | 描述 |
|--------|----------|------|------|
| [字段 1] | [类型] | [约束] | [描述] |
| [字段 2] | [类型] | [约束] | [描述] |

### 5.2 索引设计

#### [表名 1] 索引
| 索引名 | 字段 | 类型 | 描述 |
|--------|------|------|------|
| [索引名 1] | [字段] | [类型] | [描述] |

### 5.3 关系图
[数据库关系图]

## 6. 业务流程文档

### 6.1 流程描述
[业务流程详细描述]

### 6.2 流程图
[业务流程图]

### 6.3 状态转换

#### [状态机名称]
| 状态 | 事件 | 下一状态 | 动作 |
|------|------|----------|------|
| [状态 1] | [事件 1] | [状态 2] | [动作 1] |
| [状态 2] | [事件 2] | [状态 3] | [动作 2] |

## 7. 测试用例文档

### 7.1 测试目标
[测试目标描述]

### 7.2 测试场景

#### 7.2.1 场景 1: [场景名称]
- **测试步骤**:
  1. [步骤 1]
  2. [步骤 2]
  3. [步骤 3]
- **预期结果**:
  - [预期结果 1]
  - [预期结果 2]

#### 7.2.2 场景 2: [场景名称]
- **测试步骤**:
  1. [步骤 1]
  2. [步骤 2]
  3. [步骤 3]
- **预期结果**:
  - [预期结果 1]
  - [预期结果 2]

### 7.3 测试数据
[测试数据描述]

## 8. 部署文档

### 8.1 环境要求
- **操作系统**: [操作系统版本]
- **Go 版本**: [Go 版本]
- **数据库**: [数据库版本]
- **依赖服务**: [依赖服务列表]

### 8.2 安装步骤
1. [步骤 1]
2. [步骤 2]
3. [步骤 3]

### 8.3 配置说明

#### 8.3.1 配置文件
```yaml
# 配置文件示例
server:
  port: 8080
  mode: dev

database:
  driver: sqlite
  dsn: ./game.db
```

#### 8.3.2 环境变量
| 变量名 | 类型 | 默认值 | 描述 |
|--------|------|--------|------|
| [变量名 1] | [类型] | [默认值] | [描述] |
| [变量名 2] | [类型] | [默认值] | [描述] |

## 9. 监控与维护

### 9.1 监控指标
- [指标 1]: [描述]
- [指标 2]: [描述]

### 9.2 日志管理
- **日志级别**: [日志级别]
- **日志格式**: [日志格式]
- **日志存储**: [日志存储方式]

### 9.3 常见问题

#### 9.3.1 问题 1: [问题描述]
- **原因**: [原因分析]
- **解决方案**: [解决方案]

#### 9.3.2 问题 2: [问题描述]
- **原因**: [原因分析]
- **解决方案**: [解决方案]

## 10. 变更记录

| 版本 | 日期 | 作者 | 变更内容 |
|------|------|------|----------|
| 1.0 | [日期] | [作者] | 初始版本 |
| 1.1 | [日期] | [作者] | [变更内容] |
