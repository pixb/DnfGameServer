# 成就系统测试用例文档

## 1. 测试目标

验证成就系统的核心功能，包括成就触发、成就进度更新、成就完成判定、奖励领取、称号管理等功能的正确性和稳定性。确保成就系统能够正常运行，为玩家提供良好的游戏体验。

## 2. 测试环境

### 2.1 硬件环境

| 设备 | 配置 | 数量 |
| :--- | :--- | :--- |
| 服务器 | CPU: 8核, 内存: 16GB, 磁盘: 500GB | 1 |
| 客户端 | CPU: 4核, 内存: 8GB, 磁盘: 256GB | 1 |

### 2.2 软件环境

| 软件 | 版本 |
| :--- | :--- |
| 操作系统 | Linux CentOS 7.6 |
| 数据库 | MySQL 8.0 |
| Redis | 6.0+ |
| Go | 1.20+ |
| Gin | 1.9.0+ |
| gRPC | 1.50.0+ |
| 测试工具 | Postman, gRPCurl, JMeter |

### 2.3 网络环境

| 网络类型 | 带宽 | 延迟 |
| :--- | :--- | :--- |
| 局域网 | 1Gbps | <1ms |
| 公网 | 100Mbps | <50ms |

## 3. 测试场景

### 3.1 成就触发测试

#### 3.1.1 测试用例

| 测试场景 | 测试步骤 | 预期结果 | 测试数据 |
| :--- | :--- | :--- | :--- |
| 首次触发成就 | 1. 新玩家登录游戏<br>2. 触发成就行为<br>3. 查询成就进度 | 成功创建成就记录，进度更新为触发值 | `player_id: 123456, achievement_type: 1, value: 1` |
| 多次触发成就 | 1. 玩家触发成就行为多次<br>2. 查询成就进度 | 成就进度累加，达到目标值后标记为完成 | `player_id: 123456, achievement_type: 1, value: 1` |
| 同时触发多个成就 | 1. 玩家触发多个成就类型的行为<br>2. 查询多个成就进度 | 所有相关成就进度更新，达到目标值的成就标记为完成 | `player_id: 123456, achievement_type: 1, value: 1` |
| 触发不存在的成就类型 | 1. 玩家触发不存在的成就类型<br>2. 检查系统响应 | 系统正常处理，无错误信息 | `player_id: 123456, achievement_type: 999, value: 1` |

#### 3.1.2 测试代码

```go
// 测试成就触发
func TestAchievementTrigger(t *testing.T) {
    // 初始化测试数据
    playerID := uint64(123456)
    achievementType := 1
    value := 1
    
    // 调用成就触发接口
    completedAchievements, err := achievementService.CheckAchievement(playerID, achievementType, value)
    assert.NoError(t, err)
    
    // 查询玩家成就进度
    achievements, _, err := achievementService.GetAchievementList(playerID)
    assert.NoError(t, err)
    
    // 验证成就进度更新
    found := false
    for _, a := range achievements {
        if a.Id == 1 {
            found = true
            assert.Equal(t, int32(value), a.CurrentValue)
            break
        }
    }
    assert.True(t, found)
}
```

### 3.2 成就奖励领取测试

#### 3.2.1 测试用例

| 测试场景 | 测试步骤 | 预期结果 | 测试数据 |
| :--- | :--- | :--- | :--- |
| 领取已完成成就奖励 | 1. 完成成就<br>2. 领取成就奖励<br>3. 查询成就状态 | 奖励领取成功，成就状态更新为已领取 | `player_id: 123456, achievement_id: 1` |
| 领取未完成成就奖励 | 1. 成就未完成<br>2. 尝试领取奖励<br>3. 检查系统响应 | 领取失败，返回错误信息 | `player_id: 123456, achievement_id: 1` |
| 重复领取成就奖励 | 1. 完成成就并领取奖励<br>2. 再次尝试领取奖励<br>3. 检查系统响应 | 领取失败，返回错误信息 | `player_id: 123456, achievement_id: 1` |
| 领取不存在的成就奖励 | 1. 尝试领取不存在的成就奖励<br>2. 检查系统响应 | 领取失败，返回错误信息 | `player_id: 123456, achievement_id: 999` |

#### 3.2.2 测试代码

```go
// 测试成就奖励领取
func TestAchievementReward(t *testing.T) {
    // 初始化测试数据
    playerID := uint64(123456)
    achievementID := uint64(1)
    
    // 标记成就为完成
    err := markAchievementAsCompleted(playerID, achievementID)
    assert.NoError(t, err)
    
    // 领取成就奖励
    success, err := achievementService.GiveAchievementReward(playerID, achievementID)
    assert.NoError(t, err)
    assert.True(t, success)
    
    // 查询成就状态
    achievements, _, err := achievementService.GetAchievementList(playerID)
    assert.NoError(t, err)
    
    // 验证成就状态更新为已领取
    found := false
    for _, a := range achievements {
        if a.Id == achievementID {
            found = true
            assert.True(t, a.IsRewarded)
            break
        }
    }
    assert.True(t, found)
}
```

### 3.3 称号管理测试

#### 3.3.1 测试用例

| 测试场景 | 测试步骤 | 预期结果 | 测试数据 |
| :--- | :--- | :--- | :--- |
| 获得称号 | 1. 完成奖励称号的成就<br>2. 领取成就奖励<br>3. 查询称号列表 | 成功获得称号，称号列表中显示新称号 | `player_id: 123456, achievement_id: 2` |
| 佩戴称号 | 1. 获得称号<br>2. 佩戴称号<br>3. 查询称号状态 | 成功佩戴称号，称号状态更新为已佩戴 | `player_id: 123456, title_id: 1` |
| 切换称号 | 1. 佩戴第一个称号<br>2. 佩戴第二个称号<br>3. 查询称号状态 | 成功切换称号，第二个称号为已佩戴，第一个称号为未佩戴 | `player_id: 123456, title_id: 2` |
| 佩戴过期称号 | 1. 获得限时称号<br>2. 等待称号过期<br>3. 尝试佩戴称号 | 佩戴失败，返回错误信息 | `player_id: 123456, title_id: 3` |
| 佩戴不存在的称号 | 1. 尝试佩戴不存在的称号<br>2. 检查系统响应 | 佩戴失败，返回错误信息 | `player_id: 123456, title_id: 999` |

#### 3.3.2 测试代码

```go
// 测试称号佩戴
func TestTitleWear(t *testing.T) {
    // 初始化测试数据
    playerID := uint64(123456)
    titleID := uint64(1)
    
    // 确保玩家拥有该称号
    err := ensurePlayerHasTitle(playerID, titleID)
    assert.NoError(t, err)
    
    // 佩戴称号
    err = achievementService.WearTitle(playerID, titleID)
    assert.NoError(t, err)
    
    // 查询称号状态
    titles, err := achievementService.GetTitleList(playerID)
    assert.NoError(t, err)
    
    // 验证称号状态更新为已佩戴
    found := false
    for _, t := range titles {
        if t.Id == titleID {
            found = true
            assert.True(t, t.IsWearing)
            break
        }
    }
    assert.True(t, found)
}
```

### 3.4 成就列表查询测试

#### 3.4.1 测试用例

| 测试场景 | 测试步骤 | 预期结果 | 测试数据 |
| :--- | :--- | :--- | :--- |
| 查询成就列表 | 1. 玩家触发多个成就行为<br>2. 查询成就列表 | 成功返回成就列表，包含所有成就的进度和状态 | `player_id: 123456` |
| 查询空成就列表 | 1. 新玩家登录游戏<br>2. 查询成就列表 | 成功返回空成就列表 | `player_id: 999999` |
| 分页查询成就列表 | 1. 玩家拥有大量成就<br>2. 分页查询成就列表 | 成功返回分页数据，响应时间在合理范围内 | `player_id: 123456, page: 1, page_size: 20` |

#### 3.4.2 测试代码

```go
// 测试成就列表查询
func TestAchievementList(t *testing.T) {
    // 初始化测试数据
    playerID := uint64(123456)
    
    // 触发多个成就行为
    for i := 1; i <= 5; i++ {
        _, err := achievementService.CheckAchievement(playerID, i, 1)
        assert.NoError(t, err)
    }
    
    // 查询成就列表
    achievements, totalPoint, err := achievementService.GetAchievementList(playerID)
    assert.NoError(t, err)
    assert.Greater(t, len(achievements), 0)
    assert.Greater(t, totalPoint, 0)
}
```

### 3.5 称号列表查询测试

#### 3.5.1 测试用例

| 测试场景 | 测试步骤 | 预期结果 | 测试数据 |
| :--- | :--- | :--- | :--- |
| 查询称号列表 | 1. 玩家获得多个称号<br>2. 查询称号列表 | 成功返回称号列表，包含所有称号的信息和状态 | `player_id: 123456` |
| 查询空称号列表 | 1. 新玩家登录游戏<br>2. 查询称号列表 | 成功返回空称号列表 | `player_id: 999999` |
| 查询包含过期称号的列表 | 1. 玩家获得限时称号<br>2. 等待称号过期<br>3. 查询称号列表 | 成功返回称号列表，过期称号标记为已过期 | `player_id: 123456` |

#### 3.5.2 测试代码

```go
// 测试称号列表查询
func TestTitleList(t *testing.T) {
    // 初始化测试数据
    playerID := uint64(123456)
    
    // 确保玩家拥有多个称号
    for i := 1; i <= 3; i++ {
        err := ensurePlayerHasTitle(playerID, uint64(i))
        assert.NoError(t, err)
    }
    
    // 查询称号列表
    titles, err := achievementService.GetTitleList(playerID)
    assert.NoError(t, err)
    assert.Greater(t, len(titles), 0)
}
```

### 3.6 性能测试

#### 3.6.1 测试用例

| 测试场景 | 测试步骤 | 预期结果 | 测试数据 |
| :--- | :--- | :--- | :--- |
| 高并发成就触发 | 1. 模拟100个玩家同时触发成就<br>2. 监控系统响应时间和错误率 | 系统稳定运行，响应时间<100ms，错误率<1% | `concurrency: 100, duration: 60s` |
| 大量成就列表查询 | 1. 模拟100个玩家同时查询成就列表<br>2. 监控系统响应时间和错误率 | 系统稳定运行，响应时间<200ms，错误率<1% | `concurrency: 100, duration: 60s` |
| 长时间运行测试 | 1. 系统连续运行24小时<br>2. 定期触发成就和查询操作<br>3. 监控系统稳定性和资源使用 | 系统稳定运行，无内存泄漏，CPU使用率正常 | `duration: 24h` |

#### 3.6.2 测试工具

- **JMeter**：用于模拟高并发请求
- **Prometheus**：用于监控系统指标
- **Grafana**：用于展示监控数据

## 4. 测试数据

### 4.1 基础数据

#### 4.1.1 成就定义数据

| 成就ID | 成就名称 | 目标值 | 奖励类型 | 奖励ID | 奖励数量 | 成就点数 | 成就类别 |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| 1 | 初出茅庐 | 1 | 1 | 1001 | 1 | 10 | 1 |
| 2 | 任务达人 | 10 | 1 | 1002 | 1 | 20 | 1 |
| 3 | 怪物猎人 | 50 | 1 | 1003 | 1 | 30 | 2 |
| 4 | 装备大师 | 20 | 2 | 2001 | 10000 | 40 | 3 |
| 5 | 社交达人 | 5 | 3 | 3001 | 1 | 50 | 4 |

#### 4.1.2 称号定义数据

| 称号ID | 称号名称 | 属性类型 | 属性值 | 持续时间 |
| :--- | :--- | :--- | :--- | :--- |
| 1 | 勇士 | 1 | 10 | 0 |
| 2 | 英雄 | 1 | 20 | 0 |
| 3 | 传奇 | 1 | 30 | 604800 |
| 4 | 富豪 | 2 | 10 | 0 |
| 5 | 社交之王 | 3 | 10 | 0 |

### 4.2 测试账号

| 账号ID | 角色ID | 等级 | 状态 |
| :--- | :--- | :--- | :--- |
| 1 | 123456 | 1 | 活跃 |
| 2 | 234567 | 10 | 活跃 |
| 3 | 345678 | 50 | 活跃 |
| 4 | 456789 | 100 | 活跃 |
| 5 | 999999 | 1 | 新创建 |

## 5. 测试执行计划

### 5.1 测试阶段

1. **单元测试**：测试成就系统的核心模块和方法
2. **集成测试**：测试成就系统与其他系统的集成
3. **功能测试**：测试成就系统的各项功能
4. **性能测试**：测试成就系统的性能和稳定性
5. **安全测试**：测试成就系统的安全性

### 5.2 测试时间安排

| 测试阶段 | 开始时间 | 结束时间 | 持续时间 |
| :--- | :--- | :--- | :--- |
| 单元测试 | 2026-02-25 | 2026-02-25 | 1天 |
| 集成测试 | 2026-02-26 | 2026-02-26 | 1天 |
| 功能测试 | 2026-02-27 | 2026-02-28 | 2天 |
| 性能测试 | 2026-02-29 | 2026-02-29 | 1天 |
| 安全测试 | 2026-03-01 | 2026-03-01 | 1天 |
| 测试总结 | 2026-03-02 | 2026-03-02 | 1天 |

### 5.3 测试资源分配

| 角色 | 职责 | 人数 |
| :--- | :--- | :--- |
| 测试负责人 | 制定测试计划，协调测试资源 | 1 |
| 功能测试工程师 | 执行功能测试，编写测试用例 | 2 |
| 性能测试工程师 | 执行性能测试，分析性能数据 | 1 |
| 安全测试工程师 | 执行安全测试，分析安全风险 | 1 |
| 开发工程师 | 配合测试，修复测试中发现的问题 | 1 |

## 6. 测试结果分析

### 6.1 测试指标

| 指标 | 目标值 | 实际值 | 状态 |
| :--- | :--- | :--- | :--- |
| 功能测试通过率 | ≥95% | - | - |
| 性能测试响应时间 | <200ms | - | - |
| 性能测试错误率 | <1% | - | - |
| 安全测试风险等级 | 低 | - | - |
| 系统稳定性 | 24小时无故障 | - | - |

### 6.2 缺陷管理

| 缺陷ID | 缺陷描述 | 严重程度 | 修复状态 | 修复时间 |
| :--- | :--- | :--- | :--- | :--- |
| - | - | - | - | - |

### 6.3 测试报告

测试完成后，将生成详细的测试报告，包括测试结果、缺陷分析、性能数据等。

## 7. 风险评估

### 7.1 测试风险

| 风险类型 | 风险描述 | 风险等级 | 缓解措施 |
| :--- | :--- | :--- | :--- |
| 数据风险 | 测试数据丢失或损坏 | 中 | 定期备份测试数据，使用独立的测试环境 |
| 环境风险 | 测试环境不稳定 | 中 | 确保测试环境配置正确，监控环境状态 |
| 时间风险 | 测试时间不足 | 低 | 合理安排测试时间，优先测试核心功能 |
| 资源风险 | 测试资源不足 | 低 | 提前申请测试资源，确保资源充足 |

### 7.2 业务风险

| 风险类型 | 风险描述 | 风险等级 | 缓解措施 |
| :--- | :--- | :--- | :--- |
| 成就判定错误 | 成就判定逻辑错误，导致成就进度计算错误 | 高 | 详细测试成就判定逻辑，使用多种测试场景 |
| 奖励发放错误 | 奖励发放逻辑错误，导致奖励发放失败或重复发放 | 高 | 详细测试奖励发放逻辑，使用事务确保数据一致性 |
| 称号过期错误 | 称号过期时间计算错误，导致称号提前或延迟过期 | 中 | 详细测试称号过期逻辑，使用多种时间场景 |
| 性能问题 | 高并发场景下系统性能下降 | 中 | 进行充分的性能测试，优化系统性能 |

## 8. 总结

成就系统测试是确保系统质量的重要环节，通过全面的测试场景和严格的测试流程，可以发现并修复系统中的问题，确保成就系统的正常运行和玩家的良好体验。测试过程中需要关注功能正确性、性能稳定性、数据一致性等方面，确保成就系统能够满足游戏的需求。