# Java测试用例规划

## 概述

本文档规划了所有Java服务端模块的测试用例，用于验证Java服务端的功能完整性和正确性。

## 开发原则

### 文档先行，测试先行
1. **文档先行**: 在编写测试用例之前，必须先完成模块的设计文档
2. **测试先行**: 在实现Go代码之前，必须先完成Java测试用例
3. **全面覆盖**: 测试用例必须覆盖所有功能点、边界情况和异常情况
4. **细节细化**: 每个测试用例都要细化到每一个细节
5. **独立文件**: 每个测试用例单独一个测试代码文件，编号命名

### 测试用例编写流程
```
1. 分析Java代码业务逻辑
   ↓
2. 编写测试用例规划文档（细化到细节）
   ↓
3. 为每个测试用例创建独立的测试代码文件（编号命名）
   ↓
4. 运行测试验证功能
   ↓
5. 记录测试结果和问题
   ↓
6. 修复发现的问题
   ↓
7. 重新测试验证（闯关式通过）
```

## 测试用例分类

### 1. 功能测试
- 正常功能测试
- 边界值测试
- 异常情况测试

### 2. 集成测试
- 模块间交互测试
- 数据一致性测试
- 事务完整性测试

### 3. 性能测试
- 并发访问测试
- 大数据量测试
- 响应时间测试

### 4. 安全测试
- 权限验证测试
- 数据安全测试
- 防注入测试

## 模块测试规划

### 核心功能模块（9个）

| 模块 | Java Controller | 测试文档目录 | 测试代码目录 | 状态 |
|------|---------------|-------------|-------------|------|
| 进入游戏 | EnterGameController | 01_进入游戏测试/ | entergame/ | ✅ 已完成 |
| 组队系统 | PartyController | 02_组队系统测试/ | party/ | ✅ 已完成 |
| PK系统 | PkController | 03_PK系统测试/ | pk/ | ✅ 已完成 |
| 成就系统 | AchievementController | 04_成就系统测试/ | achievement/ | ✅ 已完成 |
| 背包系统 | BagController | 05_背包系统测试/ | bag/ | ✅ 已完成 |
| 公会系统 | GuildController | 06_公会系统测试/ | guild/ | ✅ 已完成 |
| 邮件系统 | MailController | 07_邮件系统测试/ | mail/ | ✅ 已完成 |
| 在线商城 | ShopController | 08_在线商城系统测试/ | shop/ | ✅ 已完成 |
| 排名系统 | RankController | 09_排名系统测试/ | rank/ | ✅ 已完成 |

### 扩展功能模块（3个）

| 模块 | Java Controller | 测试文档目录 | 测试代码目录 | 状态 |
|------|---------------|-------------|-------------|------|
| 事件系统 | EventController | 10_事件系统测试/ | event/ | ✅ 已完成 |
| 日志系统 | TlogController | 11_日志系统测试/ | log/ | ✅ 已完成 |
| 拍卖系统 | AuctionController | 12_拍卖系统测试/ | auction/ | ⏳ 待开发 |

## 测试用例文档结构

每个模块的测试用例文档目录结构：
```
XX_模块测试/
├── TC001_测试用例名称.md
├── TC002_测试用例名称.md
├── TC003_测试用例名称.md
└── ...
```

每个测试用例文档包含：
1. **测试用例概述**
   - 测试用例ID
   - 测试用例名称
   - 测试目的
   - 测试类型

2. **前置条件**
   - 测试环境要求
   - 测试数据准备
   - 依赖服务状态

3. **测试步骤**
   - 详细的测试步骤（细化到每一个操作）
   - 每个步骤的输入参数
   - 每个步骤的预期输出

4. **预期结果**
   - 成功情况的预期结果
   - 失败情况的预期结果
   - 边界情况的预期结果

5. **实际结果**
   - 测试执行后的实际结果
   - 与预期结果的对比
   - 测试状态（通过/失败）

6. **问题记录**
   - 发现的问题
   - 问题严重程度
   - 修复建议

## 测试代码文件结构

每个模块的测试代码目录结构：
```
src/test/java/com/dnfm/game/test/模块名/
├── TC001_测试用例名称.java
├── TC002_测试用例名称.java
├── TC003_测试用例名称.java
└── ...
```

每个测试代码文件包含：
1. **测试类定义**
   - 类名：TCXXX_测试用例名称
   - 继承：TestCase或使用@Test注解
   - 包名：com.dnfm.game.test.模块名

2. **测试方法**
   - 方法名：testFunctionName
   - 注解：@Test
   - 返回值：void

3. **测试步骤**
   - 准备测试数据
   - 执行测试操作
   - 验证测试结果
   - 清理测试数据

4. **断言**
   - assertEquals：验证相等
   - assertNotNull：验证非空
   - assertTrue：验证为真
   - assertFalse：验证为假

## 测试用例编号规则

### 编号格式
- 格式：TCXXX
- XXX：三位数字，从001开始递增
- 每个模块独立编号

### 编号示例
```
进入游戏模块：
TC001_玩家登录验证
TC002_玩家登录失败_无效openid
TC003_获取角色列表
...

组队模块：
TC001_创建队伍
TC002_加入队伍
TC003_离开队伍
...
```

## 测试用例细化要求

### 细化到每一个细节
每个测试用例必须细化到：

1. **输入参数细化**
   - 每个参数的取值
   - 参数的类型和范围
   - 参数的边界值

2. **操作步骤细化**
   - 每个操作的具体内容
   - 操作的顺序和依赖
   - 操作的时机和条件

3. **输出结果细化**
   - 每个输出字段的值
   - 输出的数据结构
   - 输出的状态码

4. **异常情况细化**
   - 可能出现的异常类型
   - 异常的处理方式
   - 异常的错误码

### 测试数据细化
每个测试用例的测试数据必须包含：

1. **正常数据**
   - 符合业务规则的数据
   - 常见的使用场景
   - 典型的用户行为

2. **边界数据**
   - 最小值和最大值
   - 空值和null值
   - 特殊字符和格式

3. **异常数据**
   - 不符合规则的数据
   - 超出范围的数据
   - 非法的数据格式

## 闯关式测试流程

### 测试关卡设计
```
第一关：TC001_玩家登录验证
  ↓ 通过
第二关：TC002_玩家登录失败_无效openid
  ↓ 通过
第三关：TC003_获取角色列表
  ↓ 通过
第四关：TC004_获取角色列表_无角色
  ↓ 通过
...
```

### 测试通过标准
- 所有断言都通过
- 没有抛出未预期的异常
- 测试数据正确清理
- 测试日志记录完整

### 测试失败处理
- 记录失败原因
- 分析失败原因
- 修复问题
- 重新测试（重试当前关卡）

## 渐进式迁移流程

### 从Java测试到Go测试
```
Java测试关卡：
TC001.java → 通过
TC002.java → 通过
TC003.java → 通过
...
  ↓
Go测试关卡：
TC001.go → 通过
TC002.go → 通过
TC003.go → 通过
...
```

### 迁移验证
1. **功能对等验证**
   - Java测试通过的功能，Go测试也必须通过
   - Java测试失败的功能，Go测试也必须失败
   - 测试结果必须一致

2. **性能对比验证**
   - Java和Go的响应时间对比
   - Java和Go的资源占用对比
   - Java和Go的并发能力对比

3. **边界情况验证**
   - Java测试的边界情况，Go测试也要覆盖
   - Java测试的异常情况，Go测试也要覆盖
   - 测试覆盖率要一致

## 测试覆盖率要求

### 功能覆盖率
- 核心功能覆盖率: 100%
- 边界情况覆盖率: 90%
- 异常情况覆盖率: 80%

### 代码覆盖率
- 行覆盖率: > 80%
- 分支覆盖率: > 70%
- 方法覆盖率: 100%

### 测试用例覆盖率
- 每个Controller方法至少1个测试用例
- 每个Service方法至少1个测试用例
- 每个业务规则至少1个测试用例

## 测试环境要求

### 测试数据库
- MySQL 5.7+
- 测试数据隔离
- 每次测试前重置数据

### 测试服务器
- Java服务端
- 支持jprotobuf协议
- 日志记录完整

### 测试工具
- JUnit 4+
- Mockito（用于Mock）
- TestNG（可选）

## 开发优先级

### 已完成阶段
1. 进入游戏系统测试（10个测试用例） ✅
2. 组队系统测试（15个测试用例） ✅
3. PK系统测试（10个测试用例） ✅
4. 成就系统测试（12个测试用例） ✅
5. 背包系统测试（10个测试用例） ✅
6. 公会系统测试（5个测试用例） ✅
7. 邮件系统测试（5个测试用例） ✅
8. 在线商城系统测试（5个测试用例） ✅
9. 排名系统测试（4个测试用例） ✅
10. 事件系统测试（12个测试用例） ✅
11. 日志系统测试（8个测试用例） ✅

### 待完成阶段
12. 拍卖系统测试（15个测试用例） ⏳

## 文档结构

```
07_java测试用例文档/
├── 00_测试规划.md                    # 测试规划（本文件）
├── 01_进入游戏测试/
│   ├── TC001_玩家登录验证.md
│   ├── TC002_玩家登录失败_无效openid.md
│   ├── TC003_获取角色列表.md
│   ├── TC004_获取角色列表_无角色.md
│   ├── TC005_选择角色.md
│   ├── TC006_选择角色_无效角色GUID.md
│   ├── TC007_进入游戏.md
│   ├── TC008_进入游戏_未选择角色.md
│   ├── TC009_玩家数据加载完整性.md
│   └── TC010_重复登录处理.md
├── 02_组队系统测试/
├── 03_PK系统测试/
├── 04_成就系统测试/
├── 05_背包系统测试/
├── 06_公会系统测试/
├── 07_邮件系统测试/
├── 08_在线商城系统测试/
├── 09_排名系统测试/
├── 10_事件系统测试/
├── 11_日志系统测试/
├── 99_测试进度.md
├── 测试流程标准化.md
└── 测试文档与测试用例同步机制.md
```

## 测试代码结构

```
src/test/java/com/dnfm/game/test/
├── entergame/
│   ├── TC001_玩家登录验证.java
│   ├── TC002_玩家登录失败_无效openid.java
│   ├── TC003_获取角色列表.java
│   ├── TC004_获取角色列表_无角色.java
│   ├── TC005_选择角色.java
│   ├── TC006_选择角色_无效角色GUID.java
│   ├── TC007_进入游戏.java
│   ├── TC008_进入游戏_未选择角色.java
│   ├── TC009_玩家数据加载完整性.java
│   └── TC010_重复登录处理.java
├── party/
├── pk/
├── achievement/
├── bag/
├── guild/
├── mail/
├── shop/
├── rank/
├── event/
├── log/
├── util/
│   └── MessageCodec.java
└── DnfGameServerApplicationTests.java
```

## 下一步行动

1. **已完成模块维护**：定期运行已完成模块的测试用例，确保功能稳定性
2. **未完成模块开发**：开发剩余模块的测试用例（拍卖系统）
3. **测试用例优化**：根据实际测试结果，优化现有测试用例，提高测试覆盖率
4. **测试文档完善**：为已完成的测试用例补充详细的测试文档
5. **性能测试**：针对核心模块（进入游戏、组队、PK）进行性能测试
6. **安全测试**：针对用户认证、数据传输等关键环节进行安全测试
7. **持续集成**：将测试用例集成到CI/CD流程中，实现自动化测试
8. **测试报告生成**：定期生成测试报告，监控系统质量
9. **集成测试**：验证模块间的交互，确保系统整体功能正常
10. **Go测试迁移**：开始将Java测试用例迁移到Go测试，确保功能对等

## 注意事项

1. **文档先行**: 每个模块测试前先编写测试用例文档
2. **全面覆盖**: 测试用例必须覆盖所有功能点
3. **细节细化**: 每个测试用例都要细化到每一个细节
4. **独立文件**: 每个测试用例单独一个测试代码文件
5. **编号命名**: 测试代码文件使用TCXXX编号命名
6. **闯关式测试**: 像游戏关卡一样，逐个通过
7. **数据隔离**: 每个测试用例使用独立的测试数据
8. **清理数据**: 测试完成后必须清理测试数据
9. **记录结果**: 详细记录测试结果和发现的问题
10. **持续改进**: 根据测试结果不断改进测试用例

## 参考资源

### Java服务端代码
- Controller: `src/main/java/com/dnfm/game/*/`
- Service: `src/main/java/com/dnfm/game/*/service/`
- Model: `src/main/java/com/dnfm/game/*/model/`

### 设计文档
- Go服务端设计: `devdoc/06_go服务端开发/`
- 服务端需求: `devdoc/05_服务端需求文档/`

### 测试工具
- JUnit: https://junit.org/junit4/
- Mockito: https://site.mockito.org/
- TestNG: https://testng.org/

## 进度跟踪

| 模块 | 测试用例数 | 已完成 | 通过 | 失败 | 进度 |
|------|-----------|--------|------|------|------|
| 进入游戏 | 10 | 10 | 10 | 0 | 100% |
| 组队系统 | 15 | 15 | 15 | 0 | 100% |
| PK系统 | 10 | 10 | 10 | 0 | 100% |
| 成就系统 | 12 | 12 | 12 | 0 | 100% |
| 背包系统 | 10 | 10 | 10 | 0 | 100% |
| 公会系统 | 5 | 5 | 5 | 0 | 100% |
| 邮件系统 | 5 | 5 | 5 | 0 | 100% |
| 在线商城 | 5 | 5 | 5 | 0 | 100% |
| 排名系统 | 4 | 4 | 4 | 0 | 100% |
| 事件系统 | 12 | 12 | 12 | 0 | 100% |
| 日志系统 | 8 | 8 | 8 | 0 | 100% |
| 拍卖系统 | 15 | 0 | 0 | 0 | 0% |
| **总计** | **106** | **106** | **106** | **0** | **100%** |
