# TC002_一口价购买测试用例

## 测试用例概述

### 测试用例ID
TC002

### 测试用例名称
一口价购买

### 测试目的
验证拍卖系统是否能够正确处理拍卖物品的一口价购买请求，包括正常情况下的一口价购买和响应。

### 测试类型
功能测试

## 前置条件

### 测试环境要求
1. Java服务端正常运行在端口10001
2. MySQL数据库服务正常运行
3. 测试账号和角色数据已准备

### 测试数据准备
1. 创建测试账号：test_user_auction_002
2. 创建测试角色：TestPlayerAuction002
3. 确保测试账号和角色数据在数据库中存在

### 依赖服务状态
1. Java服务端：运行中
2. MySQL数据库：运行中
3. 网络连接：正常

## 测试步骤

### 步骤1: 建立TCP连接
- **操作**：创建Socket连接到localhost:10001
- **预期输出**：TCP连接建立成功

### 步骤2: 构造登录请求
- **操作**：创建REQ_LOGIN对象，设置参数
  - openid: test_user_auction_002
  - type: 1
  - token: test_token
  - platID: 1
  - clientIP: 127.0.0.1
  - version: 1.0.0
- **预期输出**：REQ_LOGIN对象创建成功

### 步骤3: 编码登录请求
- **操作**：使用MessageCodec.encode()方法编码登录请求
- **预期输出**：编码成功，返回编码后的数据

### 步骤4: 发送登录请求
- **操作**：通过OutputStream发送编码后的登录请求
- **预期输出**：登录请求发送成功

### 步骤5: 接收登录响应
- **操作**：通过InputStream接收登录响应
- **预期输出**：接收响应成功，数据长度大于0

### 步骤6: 解码登录响应
- **操作**：使用MessageCodec.decode()方法解码登录响应
- **预期输出**：解码成功，返回RES_LOGIN对象

### 步骤7: 验证登录成功
- **操作**：验证登录响应中的error字段为null，authkey字段不为null
- **预期输出**：登录验证通过

### 步骤8: 构造一口价购买请求
- **操作**：创建REQ_AUCTION_BUYOUT对象，设置参数
  - charguid: 测试角色ID
  - auctionId: 拍卖ID
  - buyoutPrice: 一口价
  - transid: 交易ID
- **预期输出**：REQ_AUCTION_BUYOUT对象创建成功

### 步骤9: 编码一口价购买请求
- **操作**：使用MessageCodec.encode()方法编码一口价购买请求
- **预期输出**：编码成功，返回编码后的数据

### 步骤10: 发送一口价购买请求
- **操作**：通过OutputStream发送编码后的一口价购买请求
- **预期输出**：一口价购买请求发送成功

### 步骤11: 接收一口价购买响应
- **操作**：通过InputStream接收一口价购买响应
- **预期输出**：接收响应成功，数据长度大于0

### 步骤12: 解码一口价购买响应
- **操作**：使用MessageCodec.decode()方法解码一口价购买响应
- **预期输出**：解码成功，返回RES_AUCTION_BUYOUT对象

### 步骤13: 验证一口价购买成功
- **操作**：验证一口价购买响应中的error字段为0，buyoutStatus字段不为null
- **预期输出**：一口价购买验证通过

### 步骤14: 数据库验证
- **操作**：查询数据库，验证测试角色是否存在
- **预期输出**：测试角色存在于数据库中

## 预期结果

### 成功情况的预期结果
1. TCP连接建立成功
2. 登录请求发送成功
3. 登录响应接收成功
4. 登录验证通过
5. 一口价购买请求发送成功
6. 一口价购买响应接收成功
7. 一口价购买验证通过
8. 测试数据清理完成

### 失败情况的预期结果
1. TCP连接建立失败：检查服务端是否正常运行
2. 登录失败：检查测试账号和密码是否正确
3. 一口价购买失败：检查拍卖系统是否正常工作

### 边界情况的预期结果
1. 角色不存在：返回错误码和错误信息
2. 参数不完整：返回错误码和错误信息
3. 拍卖不存在：返回错误码和错误信息

## 实际结果

### 测试执行后的实际结果
- **测试状态**：⏳ 待测试
- **测试时间**：-  
- **测试执行人员**：系统自动测试

### 与预期结果的对比
- **预期结果**：一口价购买成功，返回正确的购买状态
- **实际结果**：-  
- **对比结果**：-  

### 测试状态
- **状态**：⏳ 待测试
- **备注**：无

## 问题记录

### 发现的问题
- 无

### 问题严重程度
- 无

### 修复建议
- 无

## 测试数据

### 测试账号
- **账号ID**：test_user_auction_002
- **密码**：123456
- **状态**：正常

### 测试角色
- **角色ID**：2
- **角色名称**：TestPlayerAuction002
- **职业**：1
- **等级**：10

## 测试日志

### 测试执行日志
- 无

### 错误日志
- 无

## 测试结论

### 测试总结
- 无

### 测试建议
- 无

### 风险评估
- **风险等级**：低
- **风险描述**：拍卖系统在处理大量一口价购买请求时可能存在性能问题
- **缓解措施**：优化一口价购买逻辑，使用事务确保数据一致性