# TC001_玩家登录验证

## 测试用例信息

| 项目 | 内容 |
|------|------|
| 测试用例ID | TC001 |
| 测试用例名称 | 玩家登录验证 |
| 测试级别 | 1 |
| 测试类型 | 正常流程测试 |
| 优先级 | 高 |
| 测试人员 | AI Assistant |
| 创建日期 | 2026-02-22 |
| 更新日期 | 2026-02-22 |

## 测试目的

验证玩家使用有效的openid能够成功登录到Go游戏服务器，并获取authkey和服务器时间信息。

## 测试前置条件

1. Go服务端已启动并正常运行
2. 数据库服务已启动并正常运行
3. 测试数据已准备（测试账号已存在或允许新账号注册）

## 测试数据

### 输入数据
- openid: `test_openid_001`

### 预期输出数据
- error: `0`（登录成功）
- authKey: 非空字符串
- accountKey: 非空字符串

## 测试步骤

### 步骤1: 构造登录请求
**操作内容**:
1. 创建HTTP POST请求
   - URL: `http://localhost:8081/api/v1/auth/login`
   - Content-Type: `application/json`
   - 请求体: `{"openid": "test_openid_001"}`

**预期结果**:
- 请求构造成功

### 步骤2: 发送登录请求
**操作内容**:
1. 发送HTTP请求
   - 通过测试客户端发送POST请求
   - 确保数据完整发送

**预期结果**:
- 请求发送成功
- 服务器返回HTTP 200状态码

### 步骤3: 接收登录响应
**操作内容**:
1. 接收响应数据
   - 从HTTP响应中读取JSON数据
   - 解析响应对象

**预期输出**:
- error: `0`（登录成功）
- authKey: 非空字符串
- accountKey: 非空字符串

### 步骤4: 验证登录结果
**操作内容**:
1. 验证错误码
   - 检查error字段是否为0

2. 验证authKey
   - 检查authKey是否非空
   - 检查authKey长度是否合理

3. 验证accountKey
   - 检查accountKey是否非空

**预期结果**:
- error = 0
- authKey非空且长度合理
- accountKey非空

### 步骤5: 数据库验证
**操作内容**:
1. 查询数据库
   - 查询account表
   - 根据openid查询账号信息

2. 验证账号数据
   - 检查账号是否存在
   - 检查账号状态是否正常

**预期结果**:
- 账号记录已创建或更新
- 账号状态正常

### 步骤6: 清理测试数据
**操作内容**:
1. 清理测试数据（可选）

**预期结果**:
- 测试数据清理完成

## 验证点

| 验证点 | 验证方法 | 预期结果 |
|--------|----------|----------|
| 登录请求发送 | 检查HTTP状态码 | 200 OK |
| 登录响应接收 | 检查响应JSON格式 | 格式正确 |
| 错误码验证 | 检查error字段 | error = 0 |
| authKey验证 | 检查authKey非空 | authKey非空 |
| accountKey验证 | 检查accountKey非空 | accountKey非空 |
| 数据库验证 | 查询account表 | 账号存在且状态正常 |

## 测试结果

| 测试项 | 结果 | 备注 |
|--------|------|------|
| 登录请求发送 | ⏳ 待测试 | |
| 登录响应接收 | ⏳ 待测试 | |
| 错误码验证 | ⏳ 待测试 | |
| authKey验证 | ⏳ 待测试 | |
| accountKey验证 | ⏳ 待测试 | |
| 数据库验证 | ⏳ 待测试 | |

## 测试结论

| 项目 | 结果 |
|------|------|
| 测试状态 | ⏳ 待测试 |
| 通过/失败 | - |
| 执行时间 | - |
| 测试人员 | AI Assistant |
| 测试日期 | 2026-02-22 |

## 依赖关系

- 依赖: 无
- 被依赖: TC002, TC003, TC004, TC005, TC006, TC007, TC008, TC009, TC010

## 备注

1. 本测试用例使用Go标准库的testing包和testify/suite进行测试
2. 使用自定义的HTTP客户端进行API测试
3. 服务端端口配置为8081
4. 测试数据需要根据实际数据库表结构进行调整

## 相关文件

- 测试代码: `auth_test.go`
- API接口: `POST /api/v1/auth/login`
- 配置文件: `config.dev.yaml`
- 数据库表: `account`
