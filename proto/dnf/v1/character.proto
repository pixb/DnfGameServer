syntax = "proto3";

package dnf.v1;

option go_package = "gen/dnf/v1";
option java_multiple_files = true;
option java_package = "com.dnfm.mina.protobuf.generated";
option java_outer_classname = "CharacterProto";

import "dnf/v1/common.proto";

// ========== 数据结构 ==========

// 职业限制信息
message JobLimitInfo {
  int32 job = 1;
  int32 grow_type = 2;
  int32 level = 3;
}

// 角色装备索引
message CharacterEquipIndex {
  int32 weapon = 1;
  int32 shoulder = 2;
  int32 armor = 3;
  int32 belt = 4;
  int32 pants = 5;
  int32 shoes = 6;
  int32 ring1 = 7;
  int32 ring2 = 8;
  int32 necklace = 9;
  int32 bracelet = 10;
  int32 sub_equipment = 11;
  int32 magic_stone = 12;
  int32 earring = 13;
}

// 装备索引槽位
message EquipIndexSlot {
  int32 index = 1;
  int32 slot = 2;
  int32 reforge = 3;
  int32 reforgeexp = 4;
  int32 upgrade = 5;
}

// 头像索引槽位
message AvatarIndexSlot {
  int32 index = 1;
  int32 slot = 2;
}

// 角色装备索引（列表形式）
message CharacterEquipIndexList {
  repeated EquipIndexSlot equiplist = 1;
  repeated AvatarIndexSlot avatarlist = 2;
}

// 角色信息
message Character {
  int64 char_guid = 1;
  int64 last_logout = 2;
  int32 grow_type = 3;
  int32 sec_grow_type = 4;
  int32 job = 5;
  int32 level = 6;
  string name = 7;
  int32 fatigue = 8;
  int32 equip_score = 9;
  int32 character_frame = 10;
  CharacterEquipIndex equips = 11;
  uint32 avatar_visible_flags = 12;
  int32 deletion_status = 13;
  int64 deletion_time = 14;
  int64 create_time = 15;
  bool change_name = 16;
}

// 角色信息（带装备列表）
message CharacterWithEquipList {
  int64 char_guid = 1;
  int64 last_logout = 2;
  int32 grow_type = 3;
  int32 sec_grow_type = 4;
  int32 job = 5;
  int32 level = 6;
  string name = 7;
  int32 fatigue = 8;
  int32 equip_score = 9;
  int32 character_frame = 10;
  CharacterEquipIndexList equips = 11;
  uint32 avatar_visible_flags = 12;
  int32 deletion_status = 13;
  int64 deletion_time = 14;
  int64 create_time = 15;
  bool change_name = 16;
}

// 角色详细信息
message CharacterDetailInfo {
  int64 char_guid = 1;
  int64 money = 2;
  int64 coin = 3;
  int32 exp = 4;
  int32 stat_str = 5;
  int32 stat_int = 6;
  int32 stat_vit = 7;
  int32 stat_spr = 8;
  int32 hp = 9;
  int32 max_hp = 10;
  int32 mp = 11;
  int32 max_mp = 12;
  int32 sp = 13;
  int32 max_sp = 14;
  int32 pos_map = 15;
  float pos_x = 16;
  float pos_y = 17;
  int32 status = 18;
}

// 技能信息
message SkillInfo {
  int32 skill_id = 1;
  int32 level = 2;
  int32 sp_cost = 3;
  int32 cooldown_remaining = 4;
}

// ========== 请求消息 ==========

// 角色列表请求 (module=10002, cmd=1)
message CharacterListRequest {

}

// 创建角色请求 (module=10003, cmd=0)
message CreateCharacterRequest {
  int32 job = 1;
  string name = 2;
}

// 删除角色请求 (module=10004, cmd=0)
message DeleteCharacterRequest {
  int64 char_guid = 1;
}

// 恢复删除角色请求 (module=10005, cmd=1)
message RestoreCharacterRequest {
  int64 char_guid = 1;
}

// 退出角色选择请求 (module=10017, cmd=1)
message ExitCharacterSelectRequest {
  int32 type = 1;
}

// 获取角色信息请求 (module=10100, cmd=1)
message GetCharacterInfoRequest {
  int64 char_guid = 1;
}

// 转职请求 (module=10103, cmd=1)
message ChangeJobRequest {
  int32 job = 1;
}

// 觉醒请求 (module=10105, cmd=1)
message AwakenRequest {
  int32 job = 1;
}

// 技能列表请求 (module=10106, cmd=1)
message SkillListRequest {
  int64 char_guid = 1;
}

// 学习技能请求 (module=10107, cmd=1)
message LearnSkillRequest {
  int32 skill_id = 1;
}

// 升级技能请求 (module=10108, cmd=1)
message UpgradeSkillRequest {
  int32 skill_id = 1;
}

// 属性点分配请求 (module=10109, cmd=1)
message AllocateStatPointsRequest {
  int32 str = 1;
  int32 int_ = 2;
  int32 vit = 3;
  int32 spr = 4;
}

// 转职任务完成请求 (module=10115, cmd=1)
message CompleteJobQuestRequest {
  int32 quest_id = 1;
}

// ========== 响应消息 ==========

// 角色列表响应 (module=10002, cmd=2)
message CharacterListResponse {
  int32 error = 1;
  int32 version = 2;
  repeated JobLimitInfo limits = 3;
  repeated CharacterWithEquipList characters = 4;
  int32 count = 5;
  int32 adventure_union_level = 6;
  int64 adventure_union_exp = 7;
  int32 daily_create_char_count = 8;
  int32 daily_create_char_max_count = 9;
  string adventure_union_name = 10;
  int32 max_count = 11;
  string ignore_contents_blacklist = 12;
}

// 创建角色响应 (module=10003, cmd=1)
message CreateCharacterResponse {
  int32 error = 1;
  uint64 charguid = 2;
  int32 job = 3;
  string name = 4;
}

// 删除角色响应 (module=10004, cmd=1)
message DeleteCharacterResponse {
  int32 error = 1;
  uint64 charguid = 2;
  int64 pendingtime = 3;
}

// 恢复删除角色响应 (module=10005, cmd=2)
message RestoreCharacterResponse {
  int32 error = 1;
}

// 退出角色选择响应 (module=10017, cmd=2)
message ExitCharacterSelectResponse {
  int32 error = 1;
}

// 角色详细信息响应 (module=10100, cmd=2)
message GetCharacterInfoResponse {
  int32 error = 1;
  CharacterDetailInfo detail = 2;
}

// 转职响应 (module=10103, cmd=2)
message ChangeJobResponse {
  int32 error = 1;
  int32 new_job = 2;
}

// 觉醒响应 (module=10105, cmd=2)
message AwakenResponse {
  int32 error = 1;
  int32 new_job = 2;
}

// 技能列表响应 (module=10106, cmd=2)
message SkillListResponse {
  int32 error = 1;
  repeated SkillInfo skills = 2;
}

// 学习技能响应 (module=10107, cmd=2)
message LearnSkillResponse {
  int32 error = 1;
  SkillInfo skill = 2;
}

// 升级技能响应 (module=10108, cmd=2)
message UpgradeSkillResponse {
  int32 error = 1;
  SkillInfo skill = 2;
}

// 属性点分配响应 (module=10109, cmd=2)
message AllocateStatPointsResponse {
  int32 error = 1;
  int32 stat_str = 2;
  int32 stat_int = 3;
  int32 stat_vit = 4;
  int32 stat_spr = 5;
  int32 available_points = 6;
}

// 转职任务完成响应 (module=10115, cmd=2)
message CompleteJobQuestResponse {
  int32 error = 1;
}

// ========== 批次05新增消息 ==========

// 待机请求 (module=10001, cmd=0)
message StandbyRequest {
}

// 待机响应 (module=10001, cmd=1)
message StandbyResponse {
  int32 error = 1;
  int32 standby = 2;
  int32 vip = 3;
  int32 reconnect = 4;
}

// 开始游戏请求 (module=10005, cmd=0)
message StartGameRequest {
  uint64 charguid = 1;
  uint64 dungeonguid = 2;
  string authkey = 3;
  string accesstoken = 4;
  string paytoken = 5;
  uint32 town = 6;
  uint32 area = 7;
  int32 posx = 8;
  int32 posy = 9;
  repeated ProtocolTransaction request = 10;
  uint64 partyguid = 11;
}

// 退出角色请求 (module=10007, cmd=0)
message ExitCharacterRequest {
  int32 world = 1;
  int32 channel = 2;
  int32 reservationtype = 3;
  int32 exittype = 4;
}

// ========== 批次05新增数据结构 ==========

// 协议事务
message ProtocolTransaction {
  int32 protocol = 1;
  int32 transactionid = 2;
}
